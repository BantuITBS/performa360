<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.full.min.js"></script>
    
    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.13/dist/flatpickr.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Culture Management Platform</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/lib/fosnt-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
    <style>
        :root {
            /* Light Mode Colors */
            --primary-light: #4FACFE;
            --primary-dark-light: #2575FC;
            --secondary-light: #9B59B6;
            --success-light: #2ECC71;
            --warning-light: #F1C40F;
            --info-light: #3498DB;
            --dark-light: #2C3E50;
            --light-light: #F8F9FA;
            --text-primary-light: #2D3748;
            --text-secondary-light: #4A5568;
            --bg-light: #F5F7FA;
            --card-bg-light: #FFFFFF;
            --border-light: #E2E8F0;
            
            /* Dark Mode Colors */
            --primary-dark: #4FACFE;
            --primary-dark-dark: #2575FC;
            --secondary-dark: #9B59B6;
            --success-dark: #2ECC71;
            --warning-dark: #F1C40F;
            --info-dark: #3498DB;
            --dark-dark: #1A202C;
            --light-dark: #2D3748;
            --text-primary-dark: #F7FAFC;
            --text-secondary-dark: #CBD5E0;
            --bg-dark: #1A202C;
            --card-bg-dark: #2D3748;
            --border-dark: #4A5568;
            
            /* Current Mode Variables (default to light) */
            --primary: var(--primary-light);
            --primary-dark: var(--primary-dark-light);
            --secondary: var(--secondary-light);
            --success: var(--success-light);
            --warning: var(--warning-light);
            --info: var(--info-light);
            --dark: var(--dark-light);
            --light: var(--light-light);
            --text-primary: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --bg: var(--bg-light);
            --card-bg: var(--card-bg-light);
            --border: var(--border-light);
            
            /* Other Variables */
            --border-radius: 12px;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        /* Dark Mode Overrides */
        body.dark-mode {
            --primary: var(--primary-dark);
            --primary-dark: var(--primary-dark-dark);
            --secondary: var(--secondary-dark);
            --success: var(--success-dark);
            --warning: var(--warning-dark);
            --info: var(--info-dark);
            --dark: var(--dark-dark);
            --light: var(--light-dark);
            --text-primary: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --bg: var(--bg-dark);
            --card-bg: var(--card-bg-dark);
            --border: var(--border-dark);
            
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.25);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Header Styles */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: 1rem 0;
            background: var(--card-bg);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }

        .navbar-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .navbar-brand {
            display: flex;
            align-items: center;
            text-decoration: none;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .navbar-brand i {
            margin-right: 0.75rem;
            color: var(--primary);
            font-size: 1.3rem;
            transition: var(--transition);
        }

        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: var(--border-radius);
            background: var(--light);
            color: var(--text-primary);
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: var(--border);
            transform: translateY(-2px);
        }

        .home-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: var(--border-radius);
            background: rgba(155, 89, 182, 0.1);
            color: var(--secondary);
            transition: var(--transition);
        }

        .home-btn:hover {
            background: rgba(155, 89, 182, 0.2);
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            padding: 6rem 2rem 4rem;
            position: relative;
            max-width: 1400px;
            margin: 0 auto;
        }

        .platform-intro {
            text-align: center;
            max-width: 800px;
            margin: 0 auto 4rem;
            position: relative;
            z-index: 2;
        }

        .platform-badge {
            display: inline-block;
            margin-bottom: 1.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--card-bg);
            border-radius: 50px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .platform-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1.25rem;
            background: linear-gradient(90deg, var(--secondary) 0%, var(--primary-dark) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1.2;
        }

        .platform-description {
            font-size: 1.15rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.7;
            transition: var(--transition);
        }

        /* Tiles Container */
        .tiles-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 4rem;
        }

        .tile {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            text-align: center;
            border: 1px solid var(--border);
        }

        .tile:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .tile-bg-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 8rem;
            opacity: 0.05;
            z-index: 0;
        }

        .tile-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            color: white;
            font-size: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .tile h3 {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
            color: var(--text-primary);
        }

        .tile p {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }

        .tile-feature {
            background: rgba(155, 89, 182, 0.1);
            padding: 0.75rem 1.25rem;
            border-radius: 30px;
            margin-bottom: 1rem;
            display: inline-block;
            border: 1px solid rgba(155, 89, 182, 0.15);
            font-size: 0.9rem;
            color: var(--secondary);
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .tile-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1rem;
            position: relative;
            z-index: 1;
        }

        .tile-tag {
            font-size: 0.8rem;
            color: var(--secondary);
            background: rgba(155, 89, 182, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid rgba(155, 89, 182, 0.15);
        }

        /* Platform Description */
        .platform-overview {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }

        .divider {
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--primary-dark));
            margin: 0 auto 2rem;
            border-radius: 2px;
        }

        .platform-overview h2 {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 1.25rem;
            line-height: 1.3;
            color: var(--text-primary);
        }

        .platform-overview p {
            font-size: 1.1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.7;
        }

        .platform-highlight {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            background: linear-gradient(90deg, rgba(106,17,203,0.1) 0%, rgba(37,117,252,0.1) 100%);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border);
        }

        .platform-highlight i {
            color: var(--secondary);
            font-size: 1.2rem;
        }

        .platform-highlight span {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            backdrop-filter: blur(8px);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            border-radius: 16px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
        }

        .modal-header {
            background: linear-gradient(to right, var(--dark), var(--primary-dark));
            color: white;
            padding: 1.25rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-title {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .modal-title i {
            margin-right: 0.75rem;
            font-size: 1.3rem;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex: 1;
        }

        .form-group {
            margin-bottom: 1.5rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-label i {
            color: var(--primary-dark);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--card-bg);
            font-size: 0.95rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            color: var(--text-primary);
        }

        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
            outline: none;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(37, 117, 252, 0.2);
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: #8E44AD;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #27AE60;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #F39C12;
        }

        .btn-info {
            background: var(--info);
        }

        .btn-info:hover {
            background: #2980B9;
        }

        .modal-footer {
            background: var(--light);
            padding: 1.25rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.03);
        }

        /* Competence Buttons */
        .competence-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
        }

        .competence-btn {
            border: none;
            padding: 1rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            text-align: center;
            transition: var(--transition);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .competence-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .competence-btn i {
            margin-right: 0.5rem;
        }

        /* Decorative Elements */
        .decorative-circle {
            position: absolute;
            border-radius: 50%;
            z-index: 0;
            opacity: 0.6;
        }

        .circle-1 {
            top: -200px;
            right: -200px;
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(52,152,219,0.08) 0%, rgba(52,152,219,0) 70%);
        }

        .circle-2 {
            bottom: -300px;
            left: -300px;
            width: 800px;
            height: 800px;
            background: radial-gradient(circle, rgba(46,204,113,0.05) 0%, rgba(46,204,113,0) 70%);
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .platform-title {
                font-size: 2rem;
            }
            
            .tiles-container {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
            }
            
            .competence-buttons {
                grid-template-columns: 1fr;
            }
        }


/* Manager Assessment Modal - Multiple Choice Section Styles */

/* Question block animation */
.question-block {
    animation: fadeIn 0.3s ease-out;
}

/* Textarea for question input */
.question-block textarea {
    flex: 1;
    padding: 12px 15px;
    border: 1px solid #cbd5e0;
    border-radius: 8px;
    min-height: 80px;
    resize: vertical;
    font-family: inherit;
    font-size: 15px;
}

/* Remove question button */
.question-block .remove-question-btn {
    background: #e53e3e;
    color: white;
    border: none;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

/* Response type label and select */
.response-type-container {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
}

.response-type-container label {
    font-size: 14px;
    color: #4a5568;
}

.response-type-container select {
    padding: 8px 12px;
    border: 1px solid #cbd5e0;
    border-radius: 6px;
    background: white;
    font-size: 14px;
    flex: 1;
}

/* Multiple choice options container */
.multiple-choice-options {
    width: 100%;
    margin-top: 15px;
}

/* Option input container */
.option-container {
    display: flex;
    gap: 12px;
    width: 100%;
    margin-bottom: 15px;
}

.option-container input[type="text"] {
    flex: 1;
    padding: 12px 14px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    font-size: 14px;
    color: black;
}

/* Add Option button */
.option-container .add-option-btn {
    background: #4f46e5;
    color: black;
    border: none;
    border-radius: 8px;
    padding: 0 20px;
    cursor: pointer;
    font-weight: 500;
}

/* Options list */
.options-list {
    width: 100%;
    margin-bottom: 20px;
}

.option-item {
    padding: 12px 16px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    color: black;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.option-item .delete-option-btn {
    background: #fef2f2;
    color: black;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
}

/* Correct answers container */
.correct-answers-container {
    width: 100%;
}

.correct-answers-container label {
    font-size: 15px;
    color: black;
    font-weight: 500;
    margin-bottom: 12px;
    display: block;
}

/* Add Answer button */
.correct-answers-container .add-answer-btn {
    background: #10b981;
    color: black;
    border: none;
    border-radius: 8px;
    padding: 0 20px;
    cursor: pointer;
    font-weight: 500;
}

/* Correct answers list */
.correct-answers-list {
    width: 100%;
}

.correct-answer-item {
    padding: 12px 16px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    color: black;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.correct-answer-item .delete-answer-btn {
    background: #fef2f2;
    color: black;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
}

/* Save Options button */
.save-options-btn {
    margin-top: 15px;
    background: #4f46e5;
    color: black;
    border: none;
    border-radius: 10px;
    padding: 12px 24px;
    cursor: pointer;
    font-weight: 500;
}

    </style>


<form id="my-form" style="display: none; justify-content: center; align-items: flex-start; flex-wrap: wrap; position: fixed; top: 0; left: 50%; transform: translateX(-50%); width: 100%; background: black; z-index: 9999; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); color: white;">
    <div class="form-row" style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
        
        <div class="field-container" style="display: flex; flex-direction: column; align-items: flex-start;">
            <label class="field-label" for="employee-password" style="margin-bottom: 4px; color: white;">Password:</label>
            <input class="input-small" type="text" id="employee-password" name="employee_password" placeholder="Password" style="padding: 5px; width: 150px; background: white; color: black;">
        </div>

        <div style="display: flex; flex-direction: column; align-items: flex-start;">
            <input class="input-small" type="text" id="username" name="username" style="padding: 5px; max-width: 350px; border: none; margin-bottom: 4px; background: white; color: black;">
            <label class="field-label" for="region_branch" style="display: none;">Region:</label>
            <input class="input-small" type="text" id="region_branch" name="region_branch" readonly style="max-width: 200px; border: none; display: none; background: white; color: black;">
        </div>

        <div class="field-container" style="display: flex; flex-direction: column; align-items: flex-start;">
            <label class="field-label" for="company_code" style="margin-bottom: 4px; color: white;">Company Code:</label>
            <input class="input-small" type="text" id="company_code" name="company_code" placeholder="Company Code" style="padding: 5px; width: 150px; background: white; color: black;">
        </div>

        <div class="field-container" style="display: flex; flex-direction: column; align-items: flex-start;">
            <label class="field-label" for="branch_code" style="margin-bottom: 4px; color: white;">Branch Code:</label>
            <input class="input-small" type="text" id="branch_code" name="branch_code" placeholder="Branch Code" style="padding: 5px; width: 150px; background: white; color: black;">
        </div>
        
    </div>
</form>

<body class="light-mode">
<!-- Integrated Header with Original Colors -->
<nav class="navbar" style="background: linear-gradient(to right, #3498db, #2ecc71); padding: 0.75rem 1rem; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); position: sticky; top: 0; z-index: 1000;">
    <div class="navbar-container" style="display: flex; justify-content: space-between; align-items: center; max-width: 1400px; margin: 0 auto; padding: 0 20px;margin-left: -25px;">
        
        <!-- Brand Logo & Title - Using original gradient and effects -->
        <a class="navbar-brand" href="#" style="color: white; font-weight: 700; font-size: 2rem; display: flex; align-items: center; gap: 1rem; text-decoration: none; padding: 10px 20px; border-radius: 15px; background: linear-gradient(45deg, rgba(79, 172, 254, 0.2), rgba(0, 242, 254, 0.2)); backdrop-filter: blur(5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1); position: relative; overflow: hidden;">
            <i class="fas fa-cog fa-spin" style="color: #4facfe; font-size: 1.8rem;"></i>
            <span class="animated-text">Organisational Culture Settings</span>
            <div class="shine-effect" style="position: absolute; top: -5px; left: 0; width: 30%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent); transform: translateX(-100%); transition: transform 0.6s;"></div>
        </a>

        <!-- Right Side Controls - Using original purple home icon -->
        <div class="navbar-controls" style="display: flex; align-items: center; gap: 1.5rem;">
            
            <!-- Username Display - Original transparent style -->
            <input type="text" id="username-display" placeholder="" style="width: 220px; background: transparent; color: white; border: none; padding: 0.5rem; border-radius: 6px; font-size: 0.9rem;">
            
            <!-- Theme Toggle - Original moon icon -->
            <button class="theme-toggle" id="themeToggle" style="background: none; border: none; color: white; font-size: 1.25rem; cursor: pointer; padding: 0.5rem; transition: color 0.2s ease;">
                <i class="fas fa-moon"></i>
            </button>
            
            <!-- Home Button - Original purple color -->
            <a href="http://127.0.0.1:8002/employee-appraisal/?username=#" class="home-btn" style="color: purple; font-size: 1.25rem; text-decoration: none; padding: 0.5rem; transition: transform 0.2s ease;">
                <i class="fa fa-home"></i>
            </a>
        </div>
    </div>
</nav>


    <!-- Main Content -->
    <div class="main-content" style="margin-top: -90px;">
        <!-- Decorative elements -->
        <div class="decorative-circle circle-1"></div>
        <div class="decorative-circle circle-2"></div>

        <!-- Platform Introduction -->
        <div class="platform-intro">
            <div class="platform-badge">
                <span>
                    <i class="fas fa-cogs"></i> Culture Management Platform
                </span>
            </div>
            <h1 class="platform-title">Elevate Your Organizational Culture</h1>
            <p class="platform-description">
                Transform your workplace culture with our comprehensive assessment tools designed to foster growth, collaboration, and continuous improvement.
            </p>
        </div>

        <!-- Horizontal Tiles -->
        <div class="tiles-container">
            <!-- Employee Feedback Tile -->
            <div onclick="openModal('feedbackModal')" class="tile">
                <i class="fas fa-comments tile-bg-icon" style="color: var(--secondary);"></i>
                <div class="tile-icon" style="background: linear-gradient(135deg, var(--secondary), #8e44ad);">
                    <i class="fas fa-comment-dots"></i>
                </div>
                <h3>Employee Sentiment Analysis</h3>
                <p>Gather and analyze team sentiment to improve engagement and collaboration.</p>
                <div class="tile-feature">
                    <i class="fas fa-chart-pie"></i> Sentiment Analysis
                </div>
                <div class="tile-tags">
                    <span class="tile-tag">
                        <i class="fas fa-tasks"></i> Action Items
                    </span>
                </div>
            </div>

            <!-- Peer Review Tile -->
            <div onclick="openModal('peerModal')" class="tile">
                <i class="fas fa-people-arrows tile-bg-icon" style="color: var(--info);"></i>
                <div class="tile-icon" style="background: linear-gradient(135deg, var(--info), #2980b9);">
                    <i class="fas fa-users"></i>
                </div>
                <h3>360° Peer Review</h3>
                <p>Comprehensive feedback from colleagues across all levels to identify strengths and growth areas.</p>
                <div class="tile-feature" style="background: rgba(52, 152, 219, 0.1); border-color: rgba(52, 152, 219, 0.15); color: var(--info);">
                    <i class="fas fa-sync-alt"></i> Continuous Feedback
                </div>
                <div class="tile-tags">
                    <span class="tile-tag" style="background: rgba(52, 152, 219, 0.1); border-color: rgba(52, 152, 219, 0.15); color: var(--info);">
                        <i class="fas fa-project-diagram"></i> Cross-functional
                    </span>
                </div>
            </div>

            <!-- Manager Assessment Tile -->
            <div onclick="openModal('managerModal')" class="tile">
                <i class="fas fa-user-tie tile-bg-icon" style="color: var(--warning);"></i>
                <div class="tile-icon" style="background: linear-gradient(135deg, var(--warning), #f39c12);">
                    <i class="fas fa-user-tie"></i>
                </div>
                <h3>Manager Assessment</h3>
                <p>Evaluate leadership effectiveness with structured managerial analysis.</p>
                <div class="tile-feature" style="background: rgba(241, 196, 15, 0.1); border-color: rgba(241, 196, 15, 0.15); color: var(--warning);">
                    <i class="fas fa-chart-line"></i> Data-driven Insights
                </div>
                <div class="tile-tags">
                    <span class="tile-tag" style="background: rgba(241, 196, 15, 0.1); border-color: rgba(241, 196, 15, 0.15); color: var(--warning);">
                        <i class="fas fa-clipboard-check"></i> Performance Metrics
                    </span>
                </div>
            </div>

            <!-- Self Assessment Tile -->
            <div onclick="openModal('selfModal')" class="tile">
                <i class="fas fa-user-edit tile-bg-icon" style="color: var(--success);"></i>
                <div class="tile-icon" style="background: linear-gradient(135deg, var(--success), #27ae60);">
                    <i class="fas fa-clipboard-check"></i>
                </div>
                <h3>Self Reflection</h3>
                <p>Structured self-evaluation to assess personal performance and development needs.</p>
                <div class="tile-feature" style="background: rgba(46, 204, 113, 0.1); border-color: rgba(46, 204, 113, 0.15); color: var(--success);">
                    <i class="fas fa-bullseye"></i> Goal Tracking
                </div>
                <div class="tile-tags">
                    <span class="tile-tag" style="background: rgba(46, 204, 113, 0.1); border-color: rgba(46, 204, 113, 0.15); color: var(--success);">
                        <i class="fas fa-graduation-cap"></i> Development
                    </span>
                </div>
            </div>
        </div>

        <!-- Platform Description -->
        <div class="platform-overview">
            <div class="divider"></div>
            <h2>Comprehensive Culture Management</h2>
            <p>
                This platform provides a complete solution for measuring and improving organizational culture through structured assessments, actionable insights, and continuous feedback loops.
            </p>
            <div class="platform-highlight">
                <i class="fas fa-clock"></i>
                <span>Streamlines culture management processes</span>
            </div>
        </div>
    </div>


<!-- Manager Assessment Configuration Modal -->
<div id="managerModal" class="modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000;">
  <div class="modal-content" style="border-radius: 12px;max-width: 1200px; max-height: 90vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative;">
    <!-- Modal Header -->
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="fas fa-user-tie"></i>Manager Assessment Configuration
            </h3>
            <button onclick="closeModal('managerModal')" class="modal-close">
                ×
            </button>
        </div>
        <!-- Modal Content -->
        <div class="modal-body">
            <!-- Dropdown Configuration Section -->
            <div class="dropdown-container">
                <div class="dropdown-row" style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 25px;">
                    <div id="m_target_group" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-users" style="color: #6a11cb;"></i>Target Group
                        </label>
                        <select class="dropdown-select select2" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"%236a11cb\" viewBox=\"0 0 16 16\"><path d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/></svg>'); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px;">
                            <option>Team Leads</option>
                            <option>Developers</option>
                            <option>Analysts</option>
                            <option selected>All Employees</option>
                        </select>
                    </div>
                    <div id="m_targeted_individuals" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-user" style="color: #6a11cb;"></i>Targeted Individuals
                        </label>
                        <select id="m_targeted_individuals_select" class="dropdown-select select2" multiple style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer;">
                            <option value="john_doe">John Doe</option>
                            <option value="jane_smith">Jane Smith</option>
                            <option value="mike_johnson">Mike Johnson</option>
                            <option value="emily_davis">Emily Davis</option>
                            <option value="sarah_miller">Sarah Miller</option>
                            <option value="david_wilson">David Wilson</option>
                            <option value="laura_clark">Laura Clark</option>
                            <option value="daniel_lee">Daniel Lee</option>
                            <option value="olivia_martin">Olivia Martin</option>
                            <option value="james_white">James White</option>
                            <option value="sophia_thompson">Sophia Thompson</option>
                            <option value="william_anderson">William Anderson</option>
                            <option value="ava_taylor">Ava Taylor</option>
                            <option value="ethan_moore">Ethan Moore</option>
                            <option value="mia_harris">Mia Harris</option>
                            <option value="noah_thomas">Noah Thomas</option>
                            <option value="amelia_jackson">Amelia Jackson</option>
                            <option value="logan_martinez">Logan Martinez</option>
                            <option value="charlotte_robinson">Charlotte Robinson</option>
                            <option value="lucas_clarkson">Lucas Clarkson</option>
                            <option value="grace_turner">Grace Turner</option>
                            <option value="henry_baker">Henry Baker</option>
                            <option value="emma_king">Emma King</option>
                            <option value="mason_hill">Mason Hill</option>
                        </select>
                    </div>
                    <div id="m_feedback_visibility" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-eye" style="color: #6a11cb;"></i>Feedback Visibility
                        </label>
                        <select class="dropdown-select" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"%236a11cb\" viewBox=\"0 0 16 16\"><path d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/></svg>'); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px;">
                            <option>Anonymous to Reviewee</option>
                            <option>Identified Feedback</option>
                            <option selected>Manager-Only Visibility</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Assessment Date and Frequency Container -->
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <!-- Assessment Frequency -->
                <div id="m_form_group" class="form-group" style="flex: 1; min-width: 300px;">
                    <label id="m_assessment_frequency_label" class="form-label">
                        <i class="fas fa-history"></i>Assessment Frequency
                    </label>
                    <select id="m_assessment_frequency" class="form-control" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem;">
                        <option value="">Auto set deadline</option>
                        <option value="specify-end-of-cycle">Specify end of cycle</option>
                        <option value="one-month">One month</option>
                        <option value="cycle-quarter">Cycle quarter</option>
                        <option value="cycle-mid-term">Cycle mid-term</option>
                        <option value="cycle-third-quarter">Cycle third quarter</option>
                        <option value="cycle-end-date">Cycle end-date</option>
                        <option value="review-period-quarter">Review period quarter</option>
                        <option value="review-period-mid-term">Review period mid-term</option>
                        <option value="review-period-third-quarter">Review period third quarter</option>
                        <option value="period-end-date">Review Period end-date</option>
                    </select>
                </div>
                <!-- Assessment Date -->
                <div id="m_date" class="form-group" style="flex: 1; min-width: 300px;">
                    <label id="m_date_label" class="form-label">
                        <i class="fas fa-calendar-alt"></i>Assessment Date
                    </label>
                    <input type="date" id="m_assessment_date" class="form-control" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem;">
                </div>
            </div>
            <!-- Competence Areas -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-shapes"></i>Competence Areas
                </label>
                <div id="m_competence-buttons" class="competence-buttons">
                    <!-- Communication Skills -->
                    <button class="competence-btn" type="button" onclick="createManagerCompetenceArea('Communication Skills')" style="background: linear-gradient(135deg, #f0f7ff 0%, #c9e2ff 100%); color: #1a4b8c;">
                        <i class="fas fa-comments"></i>Communication Skills
                    </button>
                    <!-- Managing Multigenerational Teams -->
                    <button class="competence-btn" type="button" onclick="createManagerCompetenceArea('Managing Multigenerational Teams')" style="background: linear-gradient(135deg, #fff5f0 0%, #ffd9c9 100%); color: #8c3a1a;">
                        <i class="fas fa-users"></i>Managing Multigenerational Teams
                    </button>
                    <!-- Performance Feedback -->
                    <button class="competence-btn" type="button" onclick="createManagerCompetenceArea('Performance Feedback')" style="background: linear-gradient(135deg, #f0fff4 0%, #c9ffd9 100%); color: #1a8c3a;">
                        <i class="fas fa-chart-line"></i>Performance Feedback
                    </button>
                    <!-- Career Development Support -->
                    <button class="competence-btn" type="button" onclick="createManagerCompetenceArea('Career Development Support')" style="background: linear-gradient(135deg, #f5f0ff 0%, #d9c9ff 100%); color: #4a1a8c;">
                        <i class="fas fa-briefcase"></i>Career Development Support
                    </button>
                    <!-- Strengths-Based Leadership -->
                    <button class="competence-btn" type="button" onclick="createManagerCompetenceArea('Strengths-Based Leadership')" style="background: linear-gradient(135deg, #fff0f5 0%, #ffc9d9 100%); color: #8c1a4a;">
                        <i class="fas fa-chess-queen"></i>Strengths-Based Leadership
                    </button>
                    <!-- Change Advocacy -->
                    <button class="competence-btn" type="button" onclick="createManagerCompetenceArea('Change Advocacy')" style="background: linear-gradient(135deg, #f0f9ff 0%, #c9e9ff 100%); color: #1a5d8c;">
                        <i class="fas fa-exchange-alt"></i>Change Advocacy
                    </button>
                </div>
                <div id="m_competence-container" style="display: flex; flex-direction: column; gap: 20px; margin-top: 25px;"></div>
            </div>
        </div>
        <!-- Modal Footer - Centered Action Buttons -->
        <div class="modal-footer">
            <button id="m_retrieve" onclick="m_retrieveSettings()" class="btn btn-success">
                <i class="fas fa-download"></i>Retrieve
            </button>
            <button id="m_save" onclick="m_saveManagerSettings()" class="btn btn-info">
                <i class="fas fa-save"></i>Save & View Table
            </button>
        </div>
    </div>
</div>




<!-- Feedback Configuration Modal -->
<div id="feedbackModal" class="modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000;">
  <div class="modal-content" style=" border-radius: 12px; max-width: 1200px; max-height: 90vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative;">
    <!-- Modal Header -->
        <div class="modal-header">
            <h3 class="modal-title">
                <i class="fas fa-comments"></i>Employee Sentiment Analysis
            </h3>
            <button onclick="closeModal('feedbackModal')" class="modal-close">
                ×
            </button>
        </div>
        <!-- Modal Content -->
        <div class="modal-body">
            <!-- Dropdown Configuration Section -->
            <div class="dropdown-container">
                <div class="dropdown-row" style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 25px;">
                    <div id="f_target_group" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-users" style="color: #6a11cb;"></i>Target Group
                        </label>
                        <select class="dropdown-select select2" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"%236a11cb\" viewBox=\"0 0 16 16\"><path d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/></svg>'); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px;">
                            <option>Team Leads</option>
                            <option>Developers</option>
                            <option>Analysts</option>
                            <option selected>All Employees</option>
                        </select>
                    </div>
                    <div id="f_targeted_individuals" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-user" style="color: #6a11cb;"></i>Targeted Individuals
                        </label>
                        <select id="f_targeted_individuals_select" class="dropdown-select select2" multiple style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer;">
                            <option value="john_doe">John Doe</option>
                            <option value="jane_smith">Jane Smith</option>
                            <option value="mike_johnson">Mike Johnson</option>
                            <option value="emily_davis">Emily Davis</option>
                            <option value="sarah_miller">Sarah Miller</option>
                            <option value="david_wilson">David Wilson</option>
                            <option value="laura_clark">Laura Clark</option>
                            <option value="daniel_lee">Daniel Lee</option>
                            <option value="olivia_martin">Olivia Martin</option>
                            <option value="james_white">James White</option>
                            <option value="sophia_thompson">Sophia Thompson</option>
                            <option value="william_anderson">William Anderson</option>
                            <option value="ava_taylor">Ava Taylor</option>
                            <option value="ethan_moore">Ethan Moore</option>
                            <option value="mia_harris">Mia Harris</option>
                            <option value="noah_thomas">Noah Thomas</option>
                            <option value="amelia_jackson">Amelia Jackson</option>
                            <option value="logan_martinez">Logan Martinez</option>
                            <option value="charlotte_robinson">Charlotte Robinson</option>
                            <option value="lucas_clarkson">Lucas Clarkson</option>
                            <option value="grace_turner">Grace Turner</option>
                            <option value="henry_baker">Henry Baker</option>
                            <option value="emma_king">Emma King</option>
                            <option value="mason_hill">Mason Hill</option>
                        </select>
                    </div>
                    <div id="f_feedback_visibility" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-eye" style="color: #6a11cb;"></i>Feedback Visibility
                        </label>
                        <select class="dropdown-select" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"%236a11cb\" viewBox=\"0 0 16 16\"><path d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/></svg>'); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px;">
                            <option>Anonymous to Reviewee</option>
                            <option>Identified Feedback</option>
                            <option selected>Manager-Only Visibility</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Assessment Date and Frequency Container -->
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <!-- Assessment Frequency -->
                <div id="f_form_group" class="form-group" style="flex: 1; min-width: 300px;">
                    <label id="f_assessment_frequency_label" class="form-label">
                        <i class="fas fa-history"></i>Assessment Frequency
                    </label>
                    <select id="f_assessment_frequency" class="form-control" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem;">
                        <option value="">Auto set deadline</option>
                        <option value="specify-end-of-cycle">Specify end of cycle</option>
                        <option value="one-month">One month</option>
                        <option value="cycle-quarter">Cycle quarter</option>
                        <option value="cycle-mid-term">Cycle mid-term</option>
                        <option value="cycle-third-quarter">Cycle third quarter</option>
                        <option value="cycle-end-date">Cycle end-date</option>
                        <option value="review-period-quarter">Review period quarter</option>
                        <option value="review-period-mid-term">Review period mid-term</option>
                        <option value="review-period-third-quarter">Review period third quarter</option>
                        <option value="period-end-date">Review Period end-date</option>
                    </select>
                </div>
                <!-- Assessment Date -->
                <div id="f_date" class="form-group" style="flex: 1; min-width: 300px;">
                    <label id="f_date_label" class="form-label">
                        <i class="fas fa-calendar-alt"></i>Assessment End Date
                    </label>
                    <input type="date" id="f_assessment_date" class="form-control" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem;">
                </div>
            </div>
            <!-- Feedback Configuration Sections -->
            <div style="border-top: 2px solid var(--border); padding-top: 25px; margin-top: 15px; max-width: 800px; margin-left: auto; margin-right: auto;">
                <h4 style="font-size: 1.3rem; color: var(--primary-dark); margin-bottom: 25px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-tasks"></i>Feedback Aspect Configuration
                </h4>
                <!-- Job Satisfaction Section -->
                <div style="background: rgba(26, 187, 156, 0.08); border-radius: 12px; padding: 20px; margin-bottom: 25px; border-left: 4px solid #1ABB9C;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h5 id="job_satisfaction_factor" style="font-size: 1.2rem; color: #1a936f; display: flex; align-items: center;">
                            <i class="fas fa-smile"></i>Job Satisfaction
                        </h5>
                        <button id="addJobSatisfactionQuestion" onclick="addQuestion(this)" class="btn btn-success" style="padding: 8px 16px; font-size: 14px;">
                            <i class="fas fa-plus"></i>Add Question
                        </button>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 20px; font-style: italic; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; text-align: center;">
                        Evaluate your work fulfillment and engagement levels
                    </p>
                    <div class="question-container" id="jobSatisfactionQuestions"></div>
                </div>
                <!-- Work-Life Balance Section -->
                <div style="background: rgba(66, 153, 225, 0.08); border-radius: 12px; padding: 20px; margin-bottom: 25px; border-left: 4px solid #4299e1;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h5 id="work_life_balance_factor" style="font-size: 1.2rem; color: #2b6cb0; display: flex; align-items: center;">
                            <i class="fas fa-balance-scale"></i>Work-Life Balance
                        </h5>
                        <button id="addWorkLifeBalanceQuestion" onclick="addQuestion(this)" class="btn btn-info" style="padding: 8px 16px; font-size: 14px;">
                            <i class="fas fa-plus"></i>Add Question
                        </button>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 20px; font-style: italic; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; text-align: center;">
                        Measure your equilibrium between professional and personal life
                    </p>
                    <div class="question-container" id="workLifeBalanceQuestions"></div>
                </div>
                <!-- Growth & Development Section -->
                <div style="background: rgba(214, 158, 46, 0.08); border-radius: 12px; padding: 20px; margin-bottom: 10px; border-left: 4px solid #d69e2e;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h5 id="growth_development_factor" style="font-size: 1.2rem; color: #b7791f; display: flex; align-items: center;">
                            <i class="fas fa-seedling"></i>Growth & Development
                        </h5>                       
                        <button id="addGrowthDevelopmentQuestion" onclick="addQuestion(this)" class="btn btn-warning" style="padding: 8px 16px; font-size: 14px;">
                            <i class="fas fa-plus"></i>Add Question
                        </button>
                    </div>
                    <p style="color: var(--text-secondary); margin-bottom: 20px; font-style: italic; background: rgba(255,255,255,0.1); padding: 12px; border-radius: 8px; text-align: center;">
                        Evaluate learning opportunities and career progression
                    </p>
                    <div class="question-container" id="growthDevelopmentQuestions"></div>
                </div>
            </div>
        </div>
        <!-- Modal Footer - Centered Action Buttons -->
        <div class="modal-footer">
            <button id="f_retrieve" onclick="f_retrieveSettings()" class="btn btn-success">
                <i class="fas fa-download"></i>Retrieve
            </button>
            <button id="f_save" onclick="f_saveFeedbackSettings()" class="btn btn-info">
                <i class="fas fa-save"></i>Save & View Table
            </button>
        </div>
    </div>
</div>



<!-- Peer Review Modal -->
<div id="peerModal" class="modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000;">
  <div id="peerModalContent" class="modal-content" style="border-radius: 12px; max-width: 1200px; max-height: 90vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative;">
    <div class="modal-header" style="background: linear-gradient(to right, #6a11cb, #2575fc); border-top-left-radius: 12px; border-top-right-radius: 12px;">
      <h3 class="modal-title">
        <i class="fas fa-users"></i>360° Peer Review Configuration
      </h3>
      <button onclick="closePeerModal()" class="modal-close">
        ×
      </button>
    </div>
        <div class="modal-body">
            <!-- Dropdown Configuration Section -->
            <div class="dropdown-container">
                <div class="dropdown-row" style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 25px;">
                    <div id="p_target_group" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-users" style="color: #6a11cb;"></i>Target Group
                        </label>
                        <select class="dropdown-select select2" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"%236a11cb\" viewBox=\"0 0 16 16\"><path d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/></svg>'); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px;">
                            <option>Team Leads</option>
                            <option>Developers</option>
                            <option>Analysts</option>
                            <option selected>All Employees</option>
                        </select>
                    </div>
                    <div id="p_targeted_individuals" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-user" style="color: #6a11cb;"></i>Targeted Individuals
                        </label>
                        <select id="p_targeted_individuals_select" class="dropdown-select select2" multiple style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer;">
                            <option value="john_doe">John Doe</option>
                            <option value="jane_smith">Jane Smith</option>
                            <option value="mike_johnson">Mike Johnson</option>
                            <option value="emily_davis">Emily Davis</option>
                            <option value="sarah_miller">Sarah Miller</option>
                            <option value="david_wilson">David Wilson</option>
                            <option value="laura_clark">Laura Clark</option>
                            <option value="daniel_lee">Daniel Lee</option>
                            <option value="olivia_martin">Olivia Martin</option>
                            <option value="james_white">James White</option>
                            <option value="sophia_thompson">Sophia Thompson</option>
                            <option value="william_anderson">William Anderson</option>
                            <option value="ava_taylor">Ava Taylor</option>
                            <option value="ethan_moore">Ethan Moore</option>
                            <option value="mia_harris">Mia Harris</option>
                            <option value="noah_thomas">Noah Thomas</option>
                            <option value="amelia_jackson">Amelia Jackson</option>
                            <option value="logan_martinez">Logan Martinez</option>
                            <option value="charlotte_robinson">Charlotte Robinson</option>
                            <option value="lucas_clarkson">Lucas Clarkson</option>
                            <option value="grace_turner">Grace Turner</option>
                            <option value="henry_baker">Henry Baker</option>
                            <option value="emma_king">Emma King</option>
                            <option value="mason_hill">Mason Hill</option>
                        </select>
                    </div>
                    <div id="p_reviewer_selection" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-random" style="color: #6a11cb;"></i>Reviewer Selection Method
                        </label>
                        <select class="dropdown-select" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"%236a11cb\" viewBox=\"0 0 16 16\"><path d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/></svg>'); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px;">
                            <option>Random Peer Selection</option>
                            <option>Employee-Chosen Peers</option>
                            <option selected>Manager-Assigned Peers</option>
                        </select>
                    </div>
                    <div id="p_feedback_visibility" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-eye" style="color: #6a11cb;"></i>Feedback Visibility
                        </label>
                        <select class="dropdown-select" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"%236a11cb\" viewBox=\"0 0 16 16\"><path d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/></svg>'); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px;">
                            <option>Anonymous to Reviewee</option>
                            <option>Identified Feedback</option>
                            <option selected>Manager-Only Visibility</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Assessment Date and Frequency Container -->
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <!-- Assessment Frequency -->
                <div id="p_form_group" class="form-group" style="flex: 1; min-width: 300px;">
                    <label id="p_assessment_frequency_label" class="form-label">
                        <i class="fas fa-history"></i>Assessment Frequency
                    </label>
                    <select id="p_assessment_frequency" class="form-control" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem;">
                        <option id="p_auto_set_deadline" value="">Auto set deadline</option>
                        <option id="p_specify_end_of_cycle" value="specify-end-of-cycle">Specify cycle (end of cycle deadline)</option>
                        <option id="p_one_month" value="one-month">One month</option>
                        <option id="p_cycle_mid_term" value="review-period-mid-term">Cycle mid-term</option>
                        <option id="p_cycle_end_date" value="review-period-end-date">Cycle end-date</option>
                        <option id="p_cycle_quarter" value="review-period-quarter">Cycle quarter</option>
                        <option id="p_review_period_mid_term" value="review-period-mid-term">Review period mid-term</option>
                        <option id="p_review_period_end_date" value="review-period-end-date">Review period end-date</option>
                        <option id="p_review_period_quarter" value="review-period-quarter">Review period quarter</option>
                        <option id="p_review_period_third_quarter" value="review-period-third-quarter">Review period third quarter</option>
                    </select>
                </div>
                <!-- Assessment Date -->
                <div id="p_date" class="form-group" style="flex: 1; min-width: 300px;">
                    <label id="p_date_label" class="form-label">
                        <i class="fas fa-calendar-alt"></i>Assessment Date
                    </label>
                    <input type="date" id="p_assessment_date" class="form-control" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem;">
                </div>
            </div>
            <!-- Criteria Cards Section -->
            <div style="border-top: 2px solid var(--border); padding-top: 25px; margin-top: 15px;">
                <h4 style="font-size: 1.4rem; color: #6a11cb; margin-bottom: 25px; display: flex; align-items: center;">
                    <i class="fas fa-star"></i>Review Criteria Configuration
                </h4>
                <!-- First row of criteria cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <!-- Innovation Card -->
                    <div class="criteria-card" onclick="openCriteriaSection(this, 'innovation')" style="background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border-left: 4px solid #8a2be2; transition: var(--transition); cursor: pointer;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(138, 43, 226, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                <i class="fas fa-lightbulb" style="color: #8a2be2; font-size: 1.3rem;"></i>
                            </div>
                            <h5 style="font-size: 1.25rem; color: #6a11cb; margin: 0;">Innovation</h5>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5;">
                            Ability to generate new ideas and solutions
                        </p>
                    </div>
                    <!-- Communication Card -->
                    <div class="criteria-card" onclick="openCriteriaSection(this, 'communication')" style="background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border-left: 4px solid #4a86e8; transition: var(--transition); cursor: pointer;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(74, 134, 232, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                <i class="fas fa-comments" style="color: #4a86e8; font-size: 1.3rem;"></i>
                            </div>
                            <h5 style="font-size: 1.25rem; color: #4a86e8; margin: 0;">Communication</h5>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5;">
                            Clarity and effectiveness in conveying ideas
                        </p>
                    </div>
                    <!-- Collaboration Card -->
                    <div class="criteria-card" onclick="openCriteriaSection(this, 'collaboration')" style="background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border-left: 4px solid #5bbfba; transition: var(--transition); cursor: pointer;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(91, 191, 186, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                <i class="fas fa-hands-helping" style="color: #5bbfba; font-size: 1.3rem;"></i>
                            </div>
                            <h5 style="font-size: 1.25rem; color: #5bbfba; margin: 0;">Collaboration</h5>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5;">
                            Effectiveness in working with others
                        </p>
                    </div>
                </div>
                <!-- Second row of criteria cards -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <!-- Problem Solving Card -->
                    <div class="criteria-card" onclick="openCriteriaSection(this, 'problem-solving')" style="background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border-left: 4px solid #ff6b6b; transition: var(--transition); cursor: pointer;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(255, 107, 107, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                <i class="fas fa-puzzle-piece" style="color: #ff6b6b; font-size: 1.3rem;"></i>
                            </div>
                            <h5 style="font-size: 1.25rem; color: #ff6b6b; margin: 0;">Problem Solving</h5>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5;">
                            Ability to analyze and resolve complex issues
                        </p>
                    </div>
                    <!-- Leadership Card -->
                    <div class="criteria-card" onclick="openCriteriaSection(this, 'leadership')" style="background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border-left: 4px solid #4ecdc4; transition: var(--transition); cursor: pointer;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(78, 205, 196, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                <i class="fas fa-chess-king" style="color: #4ecdc4; font-size: 1.3rem;"></i>
                            </div>
                            <h5 style="font-size: 1.25rem; color: #4ecdc4; margin: 0;">Leadership</h5>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5;">
                            Ability to guide and inspire team members
                        </p>
                    </div>
                    <!-- Adaptability Card -->
                    <div class="criteria-card" onclick="openCriteriaSection(this, 'adaptability')" style="background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: var(--shadow-sm); border-left: 4px solid #ffd166; transition: var(--transition); cursor: pointer;">
                        <div style="display: flex; align-items: center; margin-bottom: 15px;">
                            <div style="width: 40px; height: 40px; background: rgba(255, 209, 102, 0.1); border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                                <i class="fas fa-sync-alt" style="color: #ffd166; font-size: 1.3rem;"></i>
                            </div>
                            <h5 style="font-size: 1.25rem; color: #ffd166; margin: 0;">Adaptability</h5>
                        </div>
                        <p style="color: var(--text-secondary); margin-bottom: 15px; line-height: 1.5;">
                            Ability to adjust to new conditions and challenges
                        </p>
                    </div>
                </div>
                <!-- Full-width question section -->
                <div id="question-section" style="display: none; background: var(--card-bg); border-radius: 12px; padding: 25px; box-shadow: var(--shadow-sm); margin-top: 20px; animation: fadeIn 0.4s ease-out;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h5 id="active-criteria-title" style="font-size: 1.4rem; color: #6a11cb; margin: 0;"></h5>
                        <button id="add-question-btn" class="btn btn-secondary" style="padding: 10px 20px;">
                            <i class="fas fa-plus"></i>Add Question
                        </button>
                    </div>
                    <p id="active-criteria-desc" style="color: var(--text-secondary); margin-bottom: 20px; font-style: italic; padding-bottom: 15px; border-bottom: 1px solid var(--border);"></p>
                    <div id="question-container" style="margin-top: 20px;">
                        <!-- Questions will be added here dynamically -->
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="p_retrieve" onclick="p_retrieveSettings()" class="btn btn-success">
                <i class="fas fa-download"></i>Retrieve
            </button>
            <button id="p_save" onclick="p_savePeerSettings()" class="btn btn-secondary">
                <i class="fas fa-save"></i>Save & View Table
            </button>
        </div>
    </div>
</div>




<!-- Self Assessment Modal -->
<div id="selfModal" class="modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000;">
  <div class="modal-content" style="border-radius: 12px; max-width: 1200px; max-height: 90vh; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative;">
    <!-- Modal Header -->
        <div class="modal-header" style="background: linear-gradient(to right, #0c4b6e, #1a6ea9);">
            <h3 class="modal-title">
                <i class="fas fa-user-check"></i>Self Assessment Setup
            </h3>
            <button onclick="closeModal('selfModal')" class="modal-close">
                ×
            </button>
        </div>
        <!-- Modal Content -->
        <div class="modal-body">
            <!-- Dropdown Configuration Section -->
            <div class="dropdown-container">
                <div class="dropdown-row" style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 25px;">
                    <div id="s_target_group" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-users" style="color: #6a11cb;"></i>Target Group
                        </label>
                        <select class="dropdown-select select2" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"%236a11cb\" viewBox=\"0 0 16 16\"><path d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/></svg>'); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px;">
                            <option>Team Leads</option>
                            <option>Developers</option>
                            <option>Analysts</option>
                            <option selected>All Employees</option>
                        </select>
                    </div>
<div id="s_targeted_individuals" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
    <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-user" style="color: #6a11cb;"></i>Targeted Individuals
    </label>
    <select id="s_targeted_individuals_select" class="dropdown-select select2" multiple style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer;">
        <option value="john_doe">John Doe</option>
        <option value="jane_smith">Jane Smith</option>
        <option value="mike_johnson">Mike Johnson</option>
        <option value="emily_davis">Emily Davis</option>
        <option value="sarah_miller">Sarah Miller</option>
        <option value="david_wilson">David Wilson</option>
        <option value="laura_clark">Laura Clark</option>
        <option value="daniel_lee">Daniel Lee</option>
        <option value="olivia_martin">Olivia Martin</option>
        <option value="james_white">James White</option>
        <option value="sophia_thompson">Sophia Thompson</option>
        <option value="william_anderson">William Anderson</option>
        <option value="ava_taylor">Ava Taylor</option>
        <option value="ethan_moore">Ethan Moore</option>
        <option value="mia_harris">Mia Harris</option>
        <option value="noah_thomas">Noah Thomas</option>
        <option value="amelia_jackson">Amelia Jackson</option>
        <option value="logan_martinez">Logan Martinez</option>
        <option value="charlotte_robinson">Charlotte Robinson</option>
        <option value="lucas_clarkson">Lucas Clarkson</option>
        <option value="grace_turner">Grace Turner</option>
        <option value="henry_baker">Henry Baker</option>
        <option value="emma_king">Emma King</option>
        <option value="mason_hill">Mason Hill</option>

    </select>
</div>

                    <div id="s_feedback_visibility" class="dropdown-group" style="flex: 1; min-width: 300px; background: var(--card-bg); border-radius: 12px; padding: 20px; border: 1px solid var(--border); box-shadow: var(--shadow-sm);">
                        <label class="dropdown-label" style="display: block; margin-bottom: 12px; color: var(--text-primary); font-weight: 600; font-size: 1.1rem; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-eye" style="color: #6a11cb;"></i>Feedback Visibility
                        </label>
                        <select class="dropdown-select" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem; cursor: pointer; appearance: none; background-image: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"%236a11cb\" viewBox=\"0 0 16 16\"><path d=\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z\"/></svg>'); background-repeat: no-repeat; background-position: right 15px center; background-size: 16px;">
                            <option>Anonymous to Reviewee</option>
                            <option>Identified Feedback</option>
                            <option selected>Manager-Only Visibility</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- Assessment Date and Frequency Container -->
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <!-- Assessment Date -->

                <!-- Assessment Frequency -->
                <div id="s_form_group" class="form-group" style="flex: 1; min-width: 300px;">
                    <label id="s_assessment_frequency_label" class="form-label">
                        <i class="fas fa-history"></i>Assessment Frequency
                    </label>
                    <select id="s_assessment_frequency" class="form-control" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem;">
                        <option id="s_auto_set_deadline" value="">Auto set deadline</option>
                        <option id="s_specify_end_of_cycle" value="specify-end-of-cycle">Specify cycle (end of cycle deadline)</option>
                        <option id="s_one_month" value="one-month">One month</option>
                        <option id="s_cycle_mid_term" value="review-period-mid-term">Cycle mid-term</option>
                        <option id="s_cycle_end_date" value="review-period-end-date">Cycle end-date</option>
                        <option id="s_cycle_quarter" value="review-period-quarter">Cycle quarter</option>
                        <option id="s_review_period_mid_term" value="review-period-mid-term">Review period mid-term</option>
                        <option id="s_review_period_end_date" value="review-period-end-date">Review period end-date</option>
                        <option id="s_review_period_quarter" value="review-period-quarter">Review period quarter</option>
                        <option id="s_review_period_third_quarter" value="review-period-third-quarter">Review period third quarter</option>
                    </select>
                </div>
                <div id="s_date" class="form-group" style="flex: 1; min-width: 300px;">
                    <label id="s_date_label" class="form-label">
                        <i class="fas fa-calendar-alt"></i>Assessment Date
                    </label>
                    <input type="date" id="s_assessment_date" class="form-control" style="width: 100%; padding: 12px 15px; border-radius: 8px; border: 1px solid var(--border); background: var(--card-bg); color: var(--text-primary); font-size: 1rem;">
                </div>
            </div>
            <!-- Competence Areas -->
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-shapes"></i>Competence Areas
                </label>
                <div id="competence-buttons" class="competence-buttons">
                    <!-- Communication Skills -->
                    <button class="competence-btn" type="button" onclick="createCompetenceArea('Communication Skills')" style="background: linear-gradient(135deg, #f0f7ff 0%, #c9e2ff 100%); color: #1a4b8c;">
                        <i class="fas fa-comments"></i>Communication Skills
                    </button>
                    <!-- Managing Multigenerational Teams -->
                    <button class="competence-btn" type="button" onclick="createCompetenceArea('Managing Multigenerational Teams')" style="background: linear-gradient(135deg, #fff5f0 0%, #ffd9c9 100%); color: #8c3a1a;">
                        <i class="fas fa-users"></i>Managing Multigenerational Teams
                    </button>
                    <!-- Performance Feedback -->
                    <button class="competence-btn" type="button" onclick="createCompetenceArea('Performance Feedback')" style="background: linear-gradient(135deg, #f0fff4 0%, #c9ffd9 100%); color: #1a8c3a;">
                        <i class="fas fa-chart-line"></i>Performance Feedback
                    </button>
                    <!-- Career Development Support -->
                    <button class="competence-btn" type="button" onclick="createCompetenceArea('Career Development Support')" style="background: linear-gradient(135deg, #f5f0ff 0%, #d9c9ff 100%); color: #4a1a8c;">
                        <i class="fas fa-briefcase"></i>Career Development Support
                    </button>
                    <!-- Strengths-Based Leadership -->
                    <button class="competence-btn" type="button" onclick="createCompetenceArea('Strengths-Based Leadership')" style="background: linear-gradient(135deg, #fff0f5 0%, #ffc9d9 100%); color: #8c1a4a;">
                        <i class="fas fa-chess-queen"></i>Strengths-Based Leadership
                    </button>
                    <!-- Change Advocacy -->
                    <button class="competence-btn" type="button" onclick="createCompetenceArea('Change Advocacy')" style="background: linear-gradient(135deg, #f0f9ff 0%, #c9e9ff 100%); color: #1a5d8c;">
                        <i class="fas fa-exchange-alt"></i>Change Advocacy
                    </button>
                </div>
                <div id="competence-container" style="display: flex; flex-direction: column; gap: 20px; margin-top: 25px;"></div>
            </div>
        </div>
        <!-- Modal Footer - Centered Action Buttons -->
        <div class="modal-footer">
            <button id="s_retrieve" onclick="s_retrieveSettings()" class="btn btn-success">
                <i class="fas fa-download"></i>Retrieve
            </button>
            <button id="s_save" onclick="s_saveSettings()" class="btn" style="background: linear-gradient(135deg, #0c4b6e, #1a6ea9);">
                <i class="fas fa-save"></i>Save & View Table
            </button>
        </div>
    </div>
</div>


<!-- Manager Assessment Settings Table Modal -->
<div id="m_retrieve-modal-overlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1050; display: none; justify-content: center; align-items: center;">
  <div id="m_retrieve-modal-content" style="background: #fff; border-radius: 8px; width: 95%; max-width: 1400px; max-height: 90vh; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative; z-index: 1051;" onclick="event.stopPropagation()">
    <div style="padding: 16px 24px; background: #2b8a3e; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center; color: #fff;">
      <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Manager Assessment Settings</h3>
      <button onclick="m_closeTableModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #fff; padding: 0 8px;">×</button>
    </div>   
    <!-- Modal Body -->
    <div style="padding: 0;">
      <form id="m_managerForm">
        <div style="overflow-x: auto; padding: 16px; max-height: calc(90vh - 150px);">
          <table style="width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; min-width: 1400px; border: 1px solid #dee2e6;">
            <thead>
              <tr>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 150px;">Select</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Target Group</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Targeted Individuals</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Feedback Visibility</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Assessment Frequency</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Assessment Date</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Review Criteria</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Response Type</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Question</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Options</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Correct Answer(s)</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; text-align: left; vertical-align: middle; width: 40px;"></th>
              </tr>
            </thead>
            <tbody id="m_managerTableBody" style="color: #212529;">
            </tbody>
          </table>
        </div>
        <!-- Modal Footer with Buttons -->
        <div style="padding: 16px; border-top: 1px solid #e9ecef; text-align: center; display: flex; justify-content: center; gap: 12px;">
          <button id="m_saveManagerBtn" style="background-color: #2b8a3e; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 500; font-size: 14px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 16px;" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Save
          </button>
          <button id="m_deleteRowsBtn" onclick="m_deleteSelectedRows()" style="background-color: #2b8a3e; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 500; font-size: 14px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 16px;" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
            Delete
          </button>
          <button id="m_updateRowBtn" style="background-color: #2b8a3e; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 500; font-size: 14px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 16px;" viewBox="0 0 20 20" fill="currentColor">
              <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
              <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
            </svg>
            Update
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function m_deleteSelectedRows() {
  const tbody = document.getElementById('m_managerTableBody');
  const checkboxes = tbody.querySelectorAll('input[type="checkbox"]:checked');
  
  if (checkboxes.length === 0) {
    alert('No rows selected for deletion.');
    return;
  }
  
  checkboxes.forEach(checkbox => {
    const row = checkbox.closest('tr');
    row.remove();
  });
}
</script>


<!-- Peer Review Settings Table Modal -->
<div id="p_table-modal-overlay" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1000;display:none;justify-content:center;align-items:center;">
  <div id="p_table-modal-content" style="background:#fff;border-radius:8px;width:95%;max-width:1400px;max-height:90vh;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.15);position:relative;z-index:1001;" onclick="event.stopPropagation()">   
    <!-- Modal Header -->
    <div style="padding:16px 24px;background:#2b8a3e;border-bottom:1px solid #e9ecef;display:flex;justify-content:space-between;align-items:center;color:#fff;">
      <h3 style="margin:0;font-size:18px;font-weight:600;">Peer Review Settings</h3>
      <button onclick="p_closeTableModal()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#fff;padding:0 8px;">×</button>
    </div>   
    <!-- Modal Body -->
    <div style="padding:0;">
      <form id="p_peerForm">
        <div style="overflow-x:auto;padding:16px;max-height:calc(90vh - 150px);">
          <table style="width:100%;border-collapse:collapse;font-size:13px;table-layout:fixed;min-width:1400px;border:1px solid #dee2e6;">
            <thead>
              <tr>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:150px;">Select</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">Reviewer Selection Method</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">Feedback Visibility</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">Assessment Frequency</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">Review Criteria</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">Response Type</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:300px;">Question</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">Options</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">Correct Answer(s)</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;text-align:left;vertical-align:middle;width:40px;"></th>
              </tr>
            </thead>
            <tbody id="p_peerTableBody" style="color:#212529;">
            </tbody>
          </table>
        </div>
        <!-- Modal Footer with Buttons -->
        <div style="padding:16px;border-top:1px solid #e9ecef;text-align:center;display:flex;justify-content:center;gap:12px;">
          <button id="p_savePeerBtn" style="background-color:#2b8a3e;color:white;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width:16px;height:16px;" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Save
          </button>
          <button id="p_deleteRowsBtn" onclick="p_deleteSelectedRows()" style="background-color:#2b8a3e;color:white;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width:16px;height:16px;" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
            Delete
          </button>
          <button id="p_updateRowBtn" style="background-color:#2b8a3e;color:white;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width:16px;height:16px;" viewBox="0 0 20 20" fill="currentColor">
              <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
              <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
            </svg>
            Update
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function p_deleteSelectedRows() {
  const tbody = document.getElementById('p_peerTableBody');
  const checkboxes = tbody.querySelectorAll('input[type="checkbox"]:checked');
  
  if (checkboxes.length === 0) {
    alert('No rows selected for deletion.');
    return;
  }
  
  checkboxes.forEach(checkbox => {
    const row = checkbox.closest('tr');
    row.remove();
  });
}
</script>



<!-- Self Assessment Settings Table Modal -->
<div id="s_table-modal-overlay" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:1000;display:none;justify-content:center;align-items:center;">
  <div id="s_table-modal-content" style="background:#fff;border-radius:8px;width:95%;max-width:1400px;max-height:90vh;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.15);position:relative;z-index:1001;" onclick="event.stopPropagation()">   
    <!-- Modal Header -->
    <div style="padding:16px 24px;background:#0c4b6e;border-bottom:1px solid #e9ecef;display:flex;justify-content:space-between;align-items:center;color:#fff;">
      <h3 style="margin:0;font-size:18px;font-weight:600;">Self Assessment Settings</h3>
      <button onclick="s_closeTableModal()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#fff;padding:0 8px;">×</button>
    </div>   
    <!-- Modal Body -->
    <div style="padding:0;">
      <form id="s_selfForm">
        <div style="overflow-x:auto;padding:16px;max-height:calc(90vh - 150px);">
          <table style="width:100%;border-collapse:collapse;font-size:13px;table-layout:fixed;min-width:1400px;border:1px solid #dee2e6;">
            <thead>
              <tr>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:150px;">Status Change</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:250px;">Target Group</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:250px;">Targeted Individuals</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:250px;">Feedback Visibility</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:250px;">Assessment Frequency</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:200px;">Assessment Date</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:200px;">Feedback Aspect</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:200px;">Response Type</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:250px;">Question</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:200px;">Options</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;border-right:1px solid #dee2e6;text-align:left;vertical-align:middle;width:200px;">Correct Answer(s)</th>
                <th style="background:#f1f3f5;color:#495057;font-weight:600;text-transform:uppercase;font-size:12px;letter-spacing:0.5px;padding:8px 6px;border-bottom:2px solid #dee2e6;text-align:left;vertical-align:middle;width:40px;"></th>
              </tr>
            </thead>
            <tbody id="s_selfTableBody" style="color:#212529;">
            </tbody>
          </table>
        </div>
        <!-- Modal Footer with Buttons -->
        <div style="padding:16px;border-top:1px solid #e9ecef;text-align:center;display:flex;justify-content:center;gap:12px;">
          <button id="s_saveSelfBtn" style="background-color:#0c4b6e;color:white;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width:16px;height:16px;" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Save
          </button>
          <button id="s_deleteRowsBtn" style="background-color:#0c4b6e;color:white;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width:16px;height:16px;" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
            Delete
          </button>
          <button id="s_updateRowBtn" style="background-color:#0c4b6e;color:white;border:none;padding:10px 20px;border-radius:6px;font-weight:500;font-size:14px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width:16px;height:16px;" viewBox="0 0 20 20" fill="currentColor">
              <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
              <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
            </svg>
            Update
          </button>
        </div>
      </form>
    </div>
  </div>
</div>



<script>
function s_deleteSelectedRows() {
  const tbody = document.getElementById('s_selfTableBody');
  const checkboxes = tbody.querySelectorAll('input[type="checkbox"]:checked');
  
  if (checkboxes.length === 0) {
    alert('No rows selected for deletion.');
    return;
  }
  
  checkboxes.forEach(checkbox => {
    const row = checkbox.closest('tr');
    row.remove();
  });
}
</script>



<!-- Feedback Table Modal -->
<div id="f_retrieve-modal-overlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1050; display: none; justify-content: center; align-items: center;">
  <div id="f_retrieve-modal-content" style="background: #fff; border-radius: 8px; width: 95%; max-width: 1400px; max-height: 90vh; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.15); position: relative; z-index: 1051;" onclick="event.stopPropagation()">
    <div style="padding: 16px 24px; background: #2b8a3e; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center; color: #fff;">
      <h3 style="margin: 0; font-size: 18px; font-weight: 600;">Employee Sentiment Analysis</h3>
      <button onclick="f_closeTableModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #fff; padding: 0 8px;">×</button>
    </div>   
    <!-- Modal Body -->
    <div style="padding: 0;">
      <form id="f_feedbackForm">
        <div style="overflow-x: auto; padding: 16px; max-height: calc(90vh - 150px);">
          <table style="width: 100%; border-collapse: collapse; font-size: 13px; table-layout: fixed; min-width: 1400px; border: 1px solid #dee2e6;">
            <thead>
              <tr>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 150px;">Status Change</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Target Group</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Targeted Individuals</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Feedback Visibility</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Assessment Frequency</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Assessment Date</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Feedback Aspect</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Response Type</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 250px;">Question</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Options</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; border-right: 1px solid #dee2e6; text-align: left; vertical-align: middle; width: 200px;">Correct Answer(s)</th>
                <th style="background: #f1f3f5; color: #495057; font-weight: 600; text-transform: uppercase; font-size: 12px; letter-spacing: 0.5px; padding: 8px 6px; border-bottom: 2px solid #dee2e6; text-align: left; vertical-align: middle; width: 40px;"></th>
              </tr>
            </thead>
            <tbody id="f_feedbackTableBody" style="color: #212529;">
            </tbody>
          </table>
        </div>
        <!-- Modal Footer with Buttons -->
        <div style="padding: 16px; border-top: 1px solid #e9ecef; text-align: center; display: flex; justify-content: center; gap: 12px;">
          <button id="f_updateFeedbackBtn" style="background-color: #2b8a3e; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 500; font-size: 14px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 16px;" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
            </svg>
            Save
          </button>
          <button id="f_deleteRowsBtn" style="background-color: #2b8a3e; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 500; font-size: 14px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 16px;" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
            Delete
          </button>
          <button id="f_updateRowBtn" style="background-color: #2b8a3e; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 500; font-size: 14px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 16px;" viewBox="0 0 20 20" fill="currentColor">
              <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
              <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
            </svg>
            Update
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


<script>

// Set values for form fields
document.getElementById('employee-password').value = localStorage.getItem('employeePassword');
document.getElementById('username').value = localStorage.getItem('username');
document.getElementById('username-display').value = localStorage.getItem('username');
document.getElementById('company_code').value = localStorage.getItem('companyCode');
document.getElementById('branch_code').value = localStorage.getItem('branchCode');

  document.addEventListener('DOMContentLoaded', function () {
    const el = document.getElementById('element-id');
    if (el) {
      el.addEventListener('click', () => {
        // logic
      });
    }
  });

        // Theme Toggle Functionality
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        
        // Check for saved theme preference or use preferred color scheme
        const savedTheme = localStorage.getItem('theme') || 
                         (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        
        // Apply the saved theme
        if (savedTheme === 'dark') {
            body.classList.add('dark-mode');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            body.classList.remove('dark-mode');
            themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        }
        
        // Toggle theme on button click
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            
            if (body.classList.contains('dark-mode')) {
                localStorage.setItem('theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                localStorage.setItem('theme', 'light');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        });


// Fetch API data
fetch('http://127.0.0.1:8002/uoms/')
  .then(response => response.json())
  .then(data => {
    const uomSelectIds = [];

    // Populate select options
    uomSelectIds.forEach(id => {
      const selectElement = document.getElementById(id);
      data.forEach(uom => {
        const option = document.createElement('option');
        option.value = uom.id;
        option.text = `${uom.name} (${uom.symbol})`;
        selectElement.appendChild(option);
      });
      // Initialize Select2
      $(selectElement).select2();
    });
  })
  .catch(error => console.error('Error fetching UOM data:', error));



// These functions handle multiple-choice options and correct answers across all modals
// They manage the display, addition, and saving of multiple-choice options and correct answers

function toggleMultipleChoiceOptions(select, questionId) {
    // Toggles visibility of multiple-choice options based on selected response type
    const multipleChoiceOptions = document.getElementById(`mc-options-${questionId}`);
    const ratingScaleContainer = select.parentNode.parentNode.querySelector('.rating-scale-container');
    
    if (select.value === 'Multiple Choice') {
        multipleChoiceOptions.style.display = 'block';
        if (ratingScaleContainer) ratingScaleContainer.style.display = 'none';
    } else if (select.value === 'Rating Scale (1-5)' || select.value === 'Rating (1-5)') {
        multipleChoiceOptions.style.display = 'none';
        if (ratingScaleContainer) ratingScaleContainer.style.display = 'block';
    } else {
        multipleChoiceOptions.style.display = 'none';
        if (ratingScaleContainer) ratingScaleContainer.style.display = 'none';
    }
}

function addOption(button, questionId) {
    // Adds a new multiple-choice option, ensuring no duplicates
    const optionContainer = button.parentNode;
    const optionInput = document.getElementById(`option-input-${questionId}`);
    const optionValue = optionInput.value.trim();
    
    if (optionValue) {
        const optionsList = document.getElementById(`options-list-${questionId}`);
        const existingOptions = Array.from(optionsList.children).map(option => 
            option.textContent.replace('Delete', '').trim().toLowerCase()
        );
        
        if (!existingOptions.includes(optionValue.toLowerCase())) {
            const optionItem = document.createElement('div');
            optionItem.className = 'option-item';
            optionItem.style.cssText = `
                padding: 12px 16px;
                border: 1px solid #e2e8f0;
                border-radius: 8px;
                background: white;
                margin-bottom: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                transition: all 0.2s;
            `;
            
            optionItem.textContent = optionValue;
            
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.style.cssText = `
                background: #fef2f2;
                color: #ef4444;
                border: none;
                border-radius: 6px;
                padding: 6px 12px;
                cursor: pointer;
                font-size: 13px;
                font-weight: 500;
                transition: all 0.2s;
            `;
            
            deleteButton.onclick = function() {
                optionItem.remove();
            };
            
            optionItem.appendChild(deleteButton);
            optionsList.appendChild(optionItem);
            optionInput.value = '';
        } else {
            alert('Option already exists');
        }
    }
}

function addCorrectAnswer(button, questionId) {
    // Adds a correct answer for multiple-choice questions, ensuring it matches an existing option
    const correctAnswerContainer = button.parentNode;
    const correctAnswerInput = document.getElementById(`correct-answer-input-${questionId}`);
    const correctAnswerValue = correctAnswerInput.value.trim();
    
    if (correctAnswerValue) {
        const multipleChoiceOptions = correctAnswerContainer.closest('.multiple-choice-options');
        const optionsList = document.getElementById(`options-list-${questionId}`);
        const existingOptions = Array.from(optionsList.children).map(option => 
            option.textContent.replace('Delete', '').trim().toLowerCase()
        );
        
        if (existingOptions.includes(correctAnswerValue.toLowerCase())) {
            const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
            const existingCorrectAnswers = Array.from(correctAnswersList.children).map(answer => 
                answer.textContent.replace('Delete', '').trim().toLowerCase()
            );
            
            if (!existingCorrectAnswers.includes(correctAnswerValue.toLowerCase())) {
                const correctAnswerItem = document.createElement('div');
                correctAnswerItem.className = 'correct-answer-item';
                correctAnswerItem.style.cssText = `
                    padding: 12px 16px;
                    border: 1px solid #e2e8f0;
                    border-radius: 8px;
                    background: white;
                    margin-bottom: 8px;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    transition: all 0.2s;
                `;
                
                correctAnswerItem.textContent = correctAnswerValue;
                
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.style.cssText = `
                    background: #fef2f2;
                    color: #ef4444;
                    border: none;
                    border-radius: 6px;
                    padding: 6px 12px;
                    cursor: pointer;
                    font-size: 13px;
                    font-weight: 500;
                    transition: all 0.2s;
                `;
                
                deleteButton.onclick = function() {
                    correctAnswerItem.remove();
                };
                
                correctAnswerItem.appendChild(deleteButton);
                correctAnswersList.appendChild(correctAnswerItem);
                correctAnswerInput.value = '';
            } else {
                alert('Correct answer already exists');
            }
        } else {
            alert('Correct answer must be one of the options');
        }
    }
}

function setOptionsAndCorrectAnswers(button, questionId) {
    // Saves multiple-choice options and correct answers into hidden textboxes
    const multipleChoiceOptions = button.parentNode;
    const optionsList = document.getElementById(`options-list-${questionId}`);
    const options = Array.from(optionsList.children).map(option => option.textContent.replace('Delete', '').trim());
    const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
    const correctAnswers = Array.from(correctAnswersList.children).map(answer => answer.textContent.replace('Delete', '').trim());
    const optionsTextboxContainer = multipleChoiceOptions.querySelector('.options-textbox-container') || document.createElement('div');
    optionsTextboxContainer.className = 'options-textbox-container';
    optionsTextboxContainer.innerHTML = '';
    const optionsTextbox = document.createElement('input');
    optionsTextbox.type = 'text';
    optionsTextbox.value = options.join('|');
    optionsTextbox.style.cssText = `
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        background: white;
        font-size: 15px;
    `;
    optionsTextbox.readOnly = true;
    optionsTextboxContainer.appendChild(optionsTextbox);
    
    const correctAnswersTextboxContainer = document.getElementById(`correct-answers-textbox-${questionId}`);
    correctAnswersTextboxContainer.innerHTML = '';
    const correctAnswersTextbox = document.createElement('input');
    correctAnswersTextbox.type = 'text';
    correctAnswersTextbox.value = correctAnswers.join('|');
    correctAnswersTextbox.style.cssText = `
        width: 100%;
        padding: 12px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        background: #f0fdf4;
        font-size: 15px;
        border-color: #86efac;
    `;
    correctAnswersTextbox.readOnly = true;
    correctAnswersTextboxContainer.appendChild(correctAnswersTextbox);
    button.style.display = 'none';
    optionsList.innerHTML = '';
    correctAnswersList.innerHTML = '';
    multipleChoiceOptions.appendChild(optionsTextboxContainer);
}



// Self-Assessment Modal (id="selfModal")
// Purpose: Allows users to create and manage self-assessment questions organized by competence areas.
// Functionality:
// - Users can add competence areas dynamically and include questions within each area.
// - Questions support multiple response types (Rating Scale, Multiple Choice, Text Answer, True/False).
// - Questions can be saved to localStorage and displayed in a table modal (s_table-modal-overlay).
// - The modal includes animations for smooth UI interactions and supports question removal with transitions.

function openSelfModal() {
    // Opens the self-assessment modal
    document.getElementById('selfModal').style.display = 'flex';
}

function closeModal(modalId) {
    // Closes the specified modal
    document.getElementById(modalId).style.display = 'none';
}

function createCompetenceArea(areaName) {
    // Creates a new competence area section for self-assessment questions
    const container = document.getElementById('competence-container');
    if (document.getElementById('area-' + areaName.replace(/\s+/g, ''))) return;

    const areaDiv = document.createElement('div');
    areaDiv.id = 'area-' + areaName.replace(/\s+/g, '');
    areaDiv.style.borderLeft = '5px solid #1a6ea9';
    areaDiv.style.padding = '20px';
    areaDiv.style.borderRadius = '12px';
    areaDiv.style.background = 'white';
    areaDiv.style.boxShadow = '0 5px 20px rgba(0,0,0,0.05)';
    areaDiv.innerHTML = `
      <h3 style="color: #2c5282; font-size: 1.3rem; margin-bottom: 10px;">${areaName}</h3>
      <div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
        <button onclick="addQuestionTo('${areaDiv.id}')" style="background: #0c4b6e; color: white; border: none; padding: 8px 15px; border-radius: 6px; font-weight: 500; font-size: 14px; cursor: pointer;">
          <i class="fas fa-plus" style="margin-right: 5px;"></i>Add Question
        </button>
      </div>
      <div class="question-list" style="display: flex; flex-direction: column; gap: 20px;"></div>
    `;
    container.appendChild(areaDiv);
}

function updateQuestionNumbers(areaId) {
    // Updates question numbers within a competence area
    const questionList = document.querySelector(`#${areaId} .question-list`);
    if (!questionList) return;
    const questionBlocks = questionList.querySelectorAll('.question-block');
    questionBlocks.forEach((block, index) => {
        const numberSpan = block.querySelector('.question-number');
        if (numberSpan) {
            numberSpan.textContent = `Q${index + 1}`;
        }
        block.dataset.questionNumber = index + 1; // Store number in data attribute
    });
}

function addQuestionTo(areaId) {
    // Adds a new question to a specified competence area with numbering
    const list = document.querySelector(`#${areaId} .question-list`);
    const questionId = `question-${areaId}-${Date.now()}`;
    const block = document.createElement('div');
    block.className = 'question-block';
    block.id = questionId;
    block.dataset.questionNumber = ''; // Initialize question number
    block.style.cssText = `
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #4f46e5;
        animation: fadeIn 0.4s ease-out;
        margin-bottom: 20px;
    `;
    
    block.innerHTML = `
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
        <span class="question-number" style="font-weight: 600; color: #4f46e5; font-size: 16px;"></span>
        <textarea placeholder="Enter your self-assessment question..." 
                  style="flex: 1; 
                         padding: 14px 16px; 
                         border: 1px solid #e2e8f0; 
                         border-radius: 10px; 
                         min-height: 90px; 
                         resize: vertical; 
                         font-family: inherit; 
                         font-size: 15px;
                         transition: border 0.2s;"></textarea>
        <button onclick="this.closest('.question-block').remove(); updateQuestionNumbers('${areaId}')" 
                style="background: #ef4444; 
                       color: white; 
                       border: none; 
                       width: 40px; 
                       height: 40px; 
                       border-radius: 50%; 
                       display: flex; 
                       align-items: center; 
                       justify-content: center; 
                       cursor: pointer;
                       transition: background 0.2s;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
        <label style="font-size: 14px; color: #4a5568; font-weight: 500;">Response Type:</label>
        <select style="padding: 12px 14px; 
                      border: 1px solid #e2e8f0; 
                      border-radius: 10px; 
                      background: white; 
                      font-size: 15px; 
                      flex: 1;
                      cursor: pointer;
                      appearance: none;
                      background-image: url('data:image/svg+xml;charset=UTF-8,%3csvg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"%3e%3cpolyline points=\"6 9 12 15 18 9\"%3e%3c/polyline%3e%3c/svg%3e');
                      background-repeat: no-repeat;
                      background-position: right 12px center;
                      background-size: 16px;"
                onchange="toggleMultipleChoiceOptions(this, '${questionId}')">
          <option>Rating Scale (1-5)</option>
          <option>Multiple Choice</option>
          <option>Text Answer</option>
          <option>True / False</option>
        </select>
      </div>
      <div class="multiple-choice-options" id="mc-options-${questionId}" style="display: none; width: 100%; margin-top: 15px;">
        <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
          <input type="text" 
                 id="option-input-${questionId}"
                 placeholder="Enter option" 
                 style="flex: 1; 
                        padding: 12px 14px; 
                        border: 1px solid #e2e8f0; 
                        border-radius: 8px; 
                        background: white; 
                        font-size: 14px;">
          <button onclick="addOption(this, '${questionId}')"
                  style="background: #4f46e5;
                         color: black;
                         border: none;
                         border-radius: 8px;
                         padding: 0 20px;
                         cursor: pointer;
                         font-weight: 500;">
            Add Option
          </button>
        </div>
        <div class="options-list" id="options-list-${questionId}" style="width: 100%; margin-bottom: 20px;"></div>
        <div class="correct-answers-container" style="width: 100%;">
          <label style="font-size: 15px; color: #4a5568; font-weight: 500; margin-bottom: 12px; display: block;">Correct Answers:</label>
          <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
            <input type="text" 
                   id="correct-answer-input-${questionId}"
                   placeholder="Enter correct answer" 
                   style="flex: 1; 
                          padding: 12px 14px; 
                          border: 1px solid #e2e8f0; 
                          border-radius: 8px; 
                          background: white; 
                          font-size: 14px;">
            <button onclick="addCorrectAnswer(this, '${questionId}')"
                    style="background: #10b981;
                           color: black;
                           border: none;
                           border-radius: 8px;
                           padding: 0 20px;
                           cursor: pointer;
                           font-weight: 500;">
              Add Answer
            </button>
          </div>
          <div class="correct-answers-list" id="correct-answers-list-${questionId}" style="width: 100%;"></div>
          <div class="correct-answers-textbox-container" id="correct-answers-textbox-${questionId}"></div>
        </div>
        <button onclick="setOptionsAndCorrectAnswers(this, '${questionId}')"
                style="margin-top: 15px;
                       background: #4f46e5;
                       color: black;
                       border: none;
                       border-radius: 10px;
                       padding: 12px 24px;
                       cursor: pointer;
                       font-weight: 500;">
            Save Options
        </button>
      </div>
    `;
    
    list.appendChild(block);
    updateQuestionNumbers(areaId); // Update numbers after adding
}

function addSelfQuestion() {
    // Adds a new self-assessment question to the self-question-container
    const container = document.getElementById('self-question-container');
    const questionId = `self-question-${Date.now()}`;
    const questionBlock = document.createElement('div');
    questionBlock.className = 'question-block';
    questionBlock.id = questionId;
    questionBlock.innerHTML = `
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <textarea placeholder="Enter your question here..." 
                      style="flex: 1; 
                             padding: 12px 15px; 
                             border: 1px solid #cbd5e0; 
                             border-radius: 8px; 
                             min-height: 100px; 
                             resize: vertical; 
                             font-family: inherit; 
                             font-size: 15px;"></textarea>
            <button onclick="removeSelfQuestion('${questionId}')" 
                    style="background: #e53e3e; 
                           color: black;
                           border: none; 
                           width: 36px; 
                           height: 36px; 
                           border-radius: 50%; 
                           display: flex; 
                           align-items: center; 
                           justify-content: center; 
                           cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
            <label style="font-size: 14px; color: #4a5568;">Response Type:</label>
            <select style="padding: 8px 12px; 
                           border: 1px solid #cbd5e0; 
                           border-radius: 6px; 
                           background: white; 
                           font-size: 14px; 
                           flex: 1;"
                    onchange="toggleMultipleChoiceOptions(this, '${questionId}')">
                <option>Text Response</option>
                <option>Rating (1-5)</option>
                <option>Yes/No</option>
                <option>Percentage (0-100%)</option>
                <option>Multiple Choice</option>
            </select>
        </div>
        <div class="multiple-choice-options" id="mc-options-${questionId}" style="display: none; width: 100%; margin-top: 15px;">
            <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
                <input type="text" 
                       id="option-input-${questionId}"
                       placeholder="Enter option" 
                       style="flex: 1; 
                              padding: 12px 14px; 
                              border: 1px solid #e2e8f0; 
                              border-radius: 8px; 
                              background: white; 
                              font-size: 14px;">
                <button onclick="addOption(this, '${questionId}')"
                        style="background: #4f46e5;
                               color: black;
                               border: none;
                               border-radius: 8px;
                               padding: 0 20px;
                               cursor: pointer;
                               font-weight: 500;">
                    Add Option
                </button>
            </div>
            <div class="options-list" id="options-list-${questionId}" style="width: 100%; margin-bottom: 20px;"></div>
            <div class="correct-answers-container" style="width: 100%;">
                <label style="font-size: 15px; color: #4a5568; font-weight: 500; margin-bottom: 12px; display: block;">Correct Answers:</label>
                <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
                    <input type="text" 
                           id="correct-answer-input-${questionId}"
                           placeholder="Enter correct answer" 
                           style="flex: 1; 
                                  padding: 12px 14px; 
                                  border: 1px solid #e2e8f0; 
                                  border-radius: 8px; 
                                  background: white; 
                                  font-size: 14px;">
                    <button onclick="addCorrectAnswer(this, '${questionId}')"
                            style="background: #10b981;
                                   color: black;
                                   border: none;
                                   border-radius: 8px;
                                   padding: 0 20px;
                                   cursor: pointer;
                                   font-weight: 500;">
                        Add Answer
                    </button>
                </div>
                <div class="correct-answers-list" id="correct-answers-list-${questionId}" style="width: 100%;"></div>
                <div class="correct-answers-textbox-container" id="correct-answers-textbox-${questionId}"></div>
            </div>
            <button onclick="setOptionsAndCorrectAnswers(this, '${questionId}')"
                    style="margin-top: 15px;
                           background: #4f46e5;
                           color: black;
                           border: none;
                           border-radius: 10px;
                           padding: 12px 24px;
                           cursor: pointer;
                           font-weight: 500;">
                Save Options
            </button>
        </div>
    `;
    container.appendChild(questionBlock);
    questionBlock.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    questionBlock.style.opacity = '0';
    questionBlock.style.transform = 'translateY(20px)';
    setTimeout(() => {
        questionBlock.style.transition = 'all 0.4s ease-out';
        questionBlock.style.opacity = '1';
        questionBlock.style.transform = 'translateY(0)';
    }, 50);
}

function removeSelfQuestion(id) {
    // Removes a self-assessment question with a fade-out animation
    const questionBlock = document.getElementById(id);
    if (questionBlock) {
        questionBlock.style.transition = 'all 0.3s ease-out';
        questionBlock.style.opacity = '0';
        questionBlock.style.transform = 'translateY(-20px)';
        setTimeout(() => {
            questionBlock.remove();
            // Update question numbers for the parent competence area
            const areaId = questionBlock.closest('.question-list').parentNode.id;
            updateQuestionNumbers(areaId);
        }, 300);
    }
}

function toggleMultipleChoiceOptions(select, questionId) {
    // Toggles visibility of multiple-choice options section
    const mcOptions = document.getElementById(`mc-options-${questionId}`);
    if (mcOptions) {
        mcOptions.style.display = select.value === 'Multiple Choice' ? 'block' : 'none';
    }
}

function addOption(button, questionId) {
    // Adds an option to the options list
    const input = document.getElementById(`option-input-${questionId}`);
    const optionsList = document.getElementById(`options-list-${questionId}`);
    if (input && optionsList && input.value.trim()) {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option-item';
        optionDiv.innerHTML = `
            ${input.value.trim()}
            <button onclick="this.parentNode.remove()" class="delete-option-btn">Delete</button>
        `;
        optionsList.appendChild(optionDiv);
        input.value = ''; // Clear input
    }
}

function addCorrectAnswer(button, questionId) {
    // Adds a correct answer to the correct answers list
    const input = document.getElementById(`correct-answer-input-${questionId}`);
    const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
    if (input && correctAnswersList && input.value.trim()) {
        const answerDiv = document.createElement('div');
        answerDiv.className = 'correct-answer-item';
        answerDiv.innerHTML = `
            ${input.value.trim()}
            <button onclick="this.parentNode.remove()" class="delete-answer-btn">Delete</button>
        `;
        correctAnswersList.appendChild(answerDiv);
        input.value = ''; // Clear input
    }
}

function setOptionsAndCorrectAnswers(button, questionId) {
    // Saves options and correct answers to hidden inputs for persistence
    const optionsList = document.getElementById(`options-list-${questionId}`);
    const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
    const questionBlock = document.getElementById(questionId);
    
    if (!optionsList || !correctAnswersList || !questionBlock) {
        console.warn(`Elements for questionId ${questionId} not found`);
        return;
    }

    const options = Array.from(optionsList.children)
        .map(opt => opt.textContent.replace('Delete', '').trim())
        .filter(opt => opt);
    const correctAnswers = Array.from(correctAnswersList.children)
        .map(ans => ans.textContent.replace('Delete', '').trim())
        .filter(ans => ans);

    // Store options and correct answers in hidden inputs
    let optionsInput = questionBlock.querySelector(`input[name="options-${questionId}"]`);
    if (!optionsInput) {
        optionsInput = document.createElement('input');
        optionsInput.type = 'hidden';
        optionsInput.name = `options-${questionId}`;
        questionBlock.appendChild(optionsInput);
    }
    optionsInput.value = JSON.stringify(options);

    let correctAnswersInput = questionBlock.querySelector(`input[name="correct-answers-${questionId}"]`);
    if (!correctAnswersInput) {
        correctAnswersInput = document.createElement('input');
        correctAnswersInput.type = 'hidden';
        correctAnswersInput.name = `correct-answers-${questionId}`;
        questionBlock.appendChild(correctAnswersInput);
    }
    correctAnswersInput.value = JSON.stringify(correctAnswers);

    alert('Options and correct answers saved for this question!');
}

function s_saveSettings() {
    // Saves self-assessment settings to localStorage and opens the table modal
    const targetGroup = document.querySelector('#s_target_group select').value || '';
    const targetedIndividuals = Array.from(document.querySelector('#s_targeted_individuals_select')?.selectedOptions || []).map(opt => opt.value) || [];
    const feedbackVisibility = document.querySelector('#s_feedback_visibility select').value || '';
    const assessmentFrequency = document.querySelector('#s_assessment_frequency').value || '';
    const assessmentDate = document.querySelector('#s_assessment_date').value || '';
    const questions = [];

    document.querySelectorAll('#competence-container .question-block').forEach(questionBlock => {
        const questionId = questionBlock.id;
        const question = questionBlock.querySelector('textarea').value;
        const responseType = questionBlock.querySelector('select').value;
        const competenceArea = questionBlock.parentNode.parentNode.querySelector('h3').textContent;
        const questionNumber = questionBlock.dataset.questionNumber || '';
        const optionsList = document.getElementById(`options-list-${questionId}`);
        const options = optionsList ? Array.from(optionsList.children).map(opt => opt.textContent.replace('Delete', '').trim()) : [];
        const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
        const correctAnswers = correctAnswersList ? Array.from(correctAnswersList.children).map(ans => ans.textContent.replace('Delete', '').trim()) : [];

        if (question && questionNumber) {
            questions.push({
                question,
                responseType,
                competenceArea,
                questionNumber,
                options: responseType === 'Multiple Choice' ? options : [],
                correctAnswers: responseType === 'Multiple Choice' ? correctAnswers : [],
                completed: false // Default to false for new questions
            });
        }
    });

    const selfSettings = {
        targetGroup,
        targetedIndividuals,
        feedbackVisibility,
        assessmentFrequency,
        assessmentDate,
        questions
    };

    localStorage.setItem('selfSettings', JSON.stringify(selfSettings));
    s_openTableModal();
    closeModal('selfModal');
    alert('Self-assessment configuration saved successfully!');
}

function s_openTableModal() {
    // Opens the self-assessment table modal
    const modal = document.getElementById("s_table-modal-overlay");
    modal.style.display = "flex";
    s_loadTableSettings();
    // Focus the first focusable element
    const firstFocusable = modal.querySelector('button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if (firstFocusable) firstFocusable.focus();
}

function s_closeTableModal() {
    // Closes the self-assessment table modal
    document.getElementById("s_table-modal-overlay").style.display = "none";
}

function s_loadTableSettings() {
    // Loads and displays self-assessment settings in the table modal
    const selfSettings = JSON.parse(localStorage.getItem('selfSettings'));
    const tableBody = document.getElementById("s_selfTableBody");
    tableBody.innerHTML = "";

    if (selfSettings && selfSettings.questions) {
        selfSettings.questions.forEach((question, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:150px;">
                    <input type="checkbox" class="select-row" />
                </td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${selfSettings.targetGroup || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${selfSettings.targetedIndividuals.join(', ') || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${selfSettings.feedbackVisibility || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${selfSettings.assessmentFrequency || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${selfSettings.assessmentDate || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.competenceArea || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.responseType}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${question.questionNumber}: ${question.question}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.options.join(', ') || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.correctAnswers.join(', ') || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;text-align:center;vertical-align:middle;width:40px;">
                    <input type="checkbox" class="completed-checkbox" ${question.completed ? 'checked' : ''} onchange="s_updateSelfSettings()" />
                </td>
            `;
            tableBody.appendChild(row);
        });
    }
}

function s_deleteSelectedRows() {
    // Deletes selected rows from the table and updates localStorage
    const tbody = document.getElementById('s_selfTableBody');
    const checkboxes = tbody.querySelectorAll('input.select-row:checked');
    
    if (checkboxes.length === 0) {
        alert('No rows selected for deletion.');
        return;
    }
    
    const settings = JSON.parse(localStorage.getItem('selfSettings')) || {
        targetGroup: '',
        targetedIndividuals: [],
        feedbackVisibility: '',
        assessmentFrequency: '',
        assessmentDate: '',
        questions: []
    };
    const remainingQuestions = [];
    const deletedIndices = Array.from(checkboxes).map(checkbox => {
        const row = checkbox.closest('tr');
        return Array.from(tbody.children).indexOf(row);
    });

    settings.questions.forEach((question, index) => {
        if (!deletedIndices.includes(index)) {
            remainingQuestions.push(question);
        }
    });

    // Recalculate question numbers for remaining questions
    const updatedQuestions = [];
    const competenceAreas = [...new Set(remainingQuestions.map(q => q.competenceArea))];
    competenceAreas.forEach(area => {
        const areaQuestions = remainingQuestions.filter(q => q.competenceArea === area);
        areaQuestions.forEach((q, index) => {
            updatedQuestions.push({ ...q, questionNumber: `Q${index + 1}` });
        });
    });

    settings.questions = updatedQuestions;
    localStorage.setItem('selfSettings', JSON.stringify(settings));
    s_loadTableSettings();
    alert('Selected rows deleted successfully!');
}

function s_updateSelfSettings() {
    // Updates self-assessment settings in localStorage based on table data
    const tableBody = document.getElementById('s_selfTableBody');
    const settings = JSON.parse(localStorage.getItem('selfSettings')) || {
        targetGroup: '',
        targetedIndividuals: [],
        feedbackVisibility: '',
        assessmentFrequency: '',
        assessmentDate: '',
        questions: []
    };
    
    const updatedQuestions = [];
    Array.from(tableBody.children).forEach((row, index) => {
        const questionText = row.children[8].textContent;
        const questionNumber = questionText.match(/^Q\d+/)? questionText.match(/^Q\d+/)[0] : '';
        const question = questionText.replace(/^Q\d+: /, '');
        const completed = row.querySelector('.completed-checkbox').checked;
        updatedQuestions.push({
            question,
            responseType: row.children[7].textContent,
            competenceArea: row.children[6].textContent,
            questionNumber,
            options: row.children[9].textContent ? row.children[9].textContent.split(', ') : [],
            correctAnswers: row.children[10].textContent ? row.children[10].textContent.split(', ') : [],
            completed
        });
    });

    settings.questions = updatedQuestions;
    localStorage.setItem('selfSettings', JSON.stringify(settings));
    s_loadTableSettings();
    alert('Self-assessment settings updated successfully!');
}

function s_retrieveSettings() {
    // Retrieves and loads settings into selfModal
    const settings = JSON.parse(localStorage.getItem('selfSettings'));
    if (!settings) {
        alert('No saved settings found.');
        return;
    }

    // Populate form fields
    if (settings.targetGroup) {
        document.querySelector('#s_target_group select').value = settings.targetGroup;
    }
    if (settings.targetedIndividuals) {
        const select = document.querySelector('#s_targeted_individuals_select');
        Array.from(select.options).forEach(option => {
            option.selected = settings.targetedIndividuals.includes(option.value);
        });
    }
    if (settings.feedbackVisibility) {
        document.querySelector('#s_feedback_visibility select').value = settings.feedbackVisibility;
    }
    if (settings.assessmentFrequency) {
        document.querySelector('#s_assessment_frequency').value = settings.assessmentFrequency;
    }
    if (settings.assessmentDate) {
        document.querySelector('#s_assessment_date').value = settings.assessmentDate;
    }

    // Populate competence areas and questions
    const container = document.getElementById('competence-container');
    container.innerHTML = '';
    if (settings.questions) {
        const competenceAreas = [...new Set(settings.questions.map(q => q.competenceArea))];
        competenceAreas.forEach(area => {
            createCompetenceArea(area);
            const areaQuestions = settings.questions
                .filter(q => q.competenceArea === area)
                .sort((a, b) => parseInt(a.questionNumber.replace('Q', '')) - parseInt(b.questionNumber.replace('Q', '')));
            areaQuestions.forEach(q => {
                const areaId = 'area-' + area.replace(/\s+/g, '');
                addQuestionTo(areaId);
                const questionBlock = document.querySelector(`#${areaId} .question-list .question-block:last-child`);
                questionBlock.querySelector('textarea').value = q.question;
                questionBlock.querySelector('select').value = q.responseType;
                questionBlock.dataset.questionNumber = q.questionNumber;
                questionBlock.querySelector('.question-number').textContent = q.questionNumber;
                if (q.responseType === 'Multiple Choice') {
                    const optionsList = questionBlock.querySelector('.options-list');
                    q.options.forEach(opt => {
                        const optionDiv = document.createElement('div');
                        optionDiv.className = 'option-item';
                        optionDiv.innerHTML = `${opt}<button onclick="this.parentNode.remove()" class="delete-option-btn">Delete</button>`;
                        optionsList.appendChild(optionDiv);
                    });
                    const correctAnswersList = questionBlock.querySelector('.correct-answers-list');
                    q.correctAnswers.forEach(ans => {
                        const answerDiv = document.createElement('div');
                        answerDiv.className = 'correct-answer-item';
                        answerDiv.innerHTML = `${ans}<button onclick="this.parentNode.remove()" class="delete-answer-btn">Delete</button>`;
                        correctAnswersList.appendChild(answerDiv);
                    });
                    setOptionsAndCorrectAnswers(null, questionBlock.id);
                }
            });
        });
    }
    alert('Settings retrieved successfully!');
}

// Attach event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Initialize Select2 for targeted individuals
    if (typeof $(document.querySelector('#s_targeted_individuals_select')).select2 === 'function') {
        $(document.querySelector('#s_targeted_individuals_select')).select2({
            placeholder: 'Select individuals',
            allowClear: true
        });
    }

    // Save & View Table button
    document.getElementById('s_save')?.addEventListener('click', function(event) {
        event.preventDefault();
        s_saveSettings();
    });

    // Save button in table modal
    document.getElementById('s_saveSelfBtn')?.addEventListener('click', function(event) {
        event.preventDefault();
        s_saveSettings();
    });

    // Update button in table modal
    document.getElementById('s_updateRowBtn')?.addEventListener('click', function(event) {
        event.preventDefault();
        s_updateSelfSettings();
    });

    // Delete button in table modal
    document.getElementById('s_deleteRowsBtn')?.addEventListener('click', function(event) {
        event.preventDefault();
        s_deleteSelectedRows();
    });

    // Close modal when clicking outside content
    document.getElementById('s_table-modal-overlay')?.addEventListener('click', function(event) {
        if (event.target === this) {
            s_closeTableModal();
        }
    });
});




// Peer Review Modal (id="peerModal")
// Purpose: Facilitates the creation and management of peer review questions based on selected criteria.
// Functionality:
// - Users can select criteria, add questions, and specify response types (Text Response, Rating, Yes/No, Percentage, Multiple Choice).
// - Supports dynamic question addition with animations and criteria card interactions.
// - Saves settings to localStorage and displays them in a table modal (p_table-modal-overlay).
// - Includes UI enhancements like criteria card highlighting and modal closing on outside click.

function openPeerModal() {
    // Opens the peer review modal and loads inputs/questions
    document.getElementById('peerModal').style.display = 'flex';
    loadPeerModalInputs();
    loadQuestions();
}

function closePeerModal() {
    // Closes the peer review modal and resets criteria cards
    document.getElementById('peerModal').style.display = 'none';
    resetCriteriaCards();
}

function resetCriteriaCards() {
    // Resets the styling of criteria cards
    document.querySelectorAll('.criteria-card').forEach(card => {
        card.classList.remove('active');
        card.style.transform = 'none';
        card.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.08)';
    });
    document.getElementById('question-section').style.display = 'none';
}

function openCriteriaSection(element, criteria) {
    // Activates a criteria card and displays the question section
    resetCriteriaCards();
    element.classList.add('active');
    element.style.transform = 'translateY(-5px)';
    element.style.boxShadow = '0 15px 30px rgba(0, 0, 0, 0.15)';
    const title = element.querySelector('h5').textContent;
    const description = element.querySelector('p').textContent;
    document.getElementById('active-criteria-title').textContent = title;
    document.getElementById('active-criteria-desc').textContent = description;
    document.getElementById('question-section').style.display = 'block';
    document.getElementById('add-question-btn').onclick = function () {
        addQuestionToCriteria(criteria);
    };
}

function addQuestionToCriteria(criteria) {
    // Adds a new question to the peer review question container
    const container = document.getElementById('question-container');
    const questionId = `peer-question-${criteria}-${Date.now()}`;
    const questionBlock = document.createElement('div');
    questionBlock.className = 'question-block';
    questionBlock.id = questionId;
    questionBlock.style.cssText = `
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #3182ce;
        animation: fadeIn 0.4s ease-out;
    `;
    questionBlock.innerHTML = `
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <textarea placeholder="Enter your self-assessment question..." 
                      style="flex: 1; 
                             padding: 12px 15px; 
                             border: 1px solid #cbd5e0; 
                             border-radius: 8px; 
                             min-height: 80px; 
                             resize: vertical; 
                             font-family: inherit; 
                             font-size: 15px;"></textarea>
            <button onclick="this.closest('.question-block').remove()" 
                    style="background: #e53e3e; 
                           color: black;
                           border: none; 
                           width: 36px; 
                           height: 36px; 
                           border-radius: 50%; 
                           display: flex; 
                           align-items: center; 
                           justify-content: center; 
                           cursor: pointer;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
            <label style="font-size: 14px; color: #4a5568;">Response Type:</label>
            <select style="padding: 8px 12px; 
                           border: 1px solid #cbd5e0; 
                           border-radius: 6px; 
                           background: white; 
                           font-size: 14px; 
                           flex: 1;"
                    onchange="toggleMultipleChoiceOptions(this, '${questionId}')">
                <option>Text Response</option>
                <option>Rating (1-5)</option>
                <option>Yes/No</option>
                <option>Percentage (0-100%)</option>
                <option>Multiple Choice</option>
            </select>
        </div>
        <div class="multiple-choice-options" id="mc-options-${questionId}" style="display: none; width: 100%; margin-top: 15px;">
            <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
                <input type="text" 
                       id="option-input-${questionId}"
                       placeholder="Enter option" 
                       style="flex: 1; 
                              padding: 12px 14px; 
                              border: 1px solid #e2e8f0; 
                              border-radius: 8px; 
                              background: white; 
                              font-size: 14px;">
                <button onclick="addOption(this, '${questionId}')"
                        style="background: #4f46e5;
                               color: black;
                               border: none;
                               border-radius: 8px;
                               padding: 0 20px;
                               cursor: pointer;
                               font-weight: 500;">
                    Add Option
                </button>
            </div>
            <div class="options-list" id="options-list-${questionId}" style="width: 100%; margin-bottom: 20px;"></div>
            <div class="correct-answers-container" style="width: 100%;">
                <label style="font-size: 15px; color: #4a5568; font-weight: 500; margin-bottom: 12px; display: block;">Correct Answers:</label>
                <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
                    <input type="text" 
                           id="correct-answer-input-${questionId}"
                           placeholder="Enter correct answer" 
                           style="flex: 1; 
                                  padding: 12px 14px; 
                                  border: 1px solid #e2e8f0; 
                                  border-radius: 8px; 
                                  background: white; 
                                  font-size: 14px;">
                    <button onclick="addCorrectAnswer(this, '${questionId}')"
                            style="background: #10b981;
                                   color: black;
                                   border: none;
                                   border-radius: 8px;
                                   padding: 0 20px;
                                   cursor: pointer;
                                   font-weight: 500;">
                        Add Answer
                    </button>
                </div>
                <div class="correct-answers-list" id="correct-answers-list-${questionId}" style="width: 100%;"></div>
                <div class="correct-answers-textbox-container" id="correct-answers-textbox-${questionId}"></div>
            </div>
            <button onclick="setOptionsAndCorrectAnswers(this, '${questionId}')"
                    style="margin-top: 15px;
                           background: #4f46e5;
                           color: white;
                           border: none;
                           border-radius: 10px;
                           padding: 12px 24px;
                           cursor: pointer;
                           font-weight: 500;">
                Save Options
            </button>
        </div>
    `;
    container.appendChild(questionBlock);
}

function loadPeerModalInputs() {
    // Loads saved peer modal inputs from localStorage
    const peerModalData = JSON.parse(localStorage.getItem('peerModalData'));
    if (peerModalData) {
        const peerModalInputs = document.querySelectorAll('#peerModal input, #peerModal select');
        peerModalInputs.forEach(input => {
            const inputName = input.name || input.id;
            if (inputName && peerModalData[inputName]) {
                input.value = peerModalData[inputName];
            }
        });
    }
}

function loadQuestions() {
    // Loads saved peer review questions from localStorage
    const questions = JSON.parse(localStorage.getItem('questions'));
    if (questions) {
        const container = document.getElementById('question-container');
        container.innerHTML = '';
        questions.forEach(question => {
            const questionId = `peer-question-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            const questionBlock = document.createElement('div');
            questionBlock.className = 'question-block';
            questionBlock.id = questionId;
            questionBlock.innerHTML = `
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <textarea placeholder="Enter your self-assessment question..." 
                              style="flex: 1; padding: 12px 15px; border: 1px solid #cbd5e0; border-radius: 8px; min-height: 80px; resize: vertical; font-family: inherit; font-size: 15px;">${question.question}</textarea>
                    <button onclick="this.closest('.question-block').remove()" 
                            style="background: #e53e3e; color: white; border: none; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                    <label style="font-size: 14px; color: #4a5568;">Response Type:</label>
                    <select style="padding: 8px 12px; border: 1px solid #cbd5e0; border-radius: 6px; background: white; font-size: 14px; flex: 1;"
                            onchange="toggleMultipleChoiceOptions(this, '${questionId}')">
                        <option ${question.responseType === 'Text Response' ? 'selected' : ''}>Text Response</option>
                        <option ${question.responseType === 'Rating (1-5)' ? 'selected' : ''}>Rating (1-5)</option>
                        <option ${question.responseType === 'Yes/No' ? 'selected' : ''}>Yes/No</option>
                        <option ${question.responseType === 'Percentage (0-100%)' ? 'selected' : ''}>Percentage (0-100%)</option>
                        <option ${question.responseType === 'Multiple Choice' ? 'selected' : ''}>Multiple Choice</option>
                    </select>
                </div>
                <div id="mc-options-${questionId}" style="display: ${question.responseType === 'Multiple Choice' ? 'block' : 'none'};">
                    <div class="options-container" style="margin-bottom: 15px;">
                        <label style="font-size: 14px; color: #4a5568;">Options:</label>
                        <div id="options-list-${questionId}" style="margin-top: 5px;">
                            ${question.options ? question.options.map(opt => `
                                <div class="option-item" style="display: flex; gap: 10px; margin-bottom: 5px;">
                                    <input type="text" value="${opt}" style="flex: 1; padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px;" />
                                    <button onclick="this.closest('.option-item').remove()" style="padding: 8px; background: #e53e3e; color: white; border: none; border-radius: 6px; cursor: pointer;">Remove</button>
                                </div>
                            `).join('') : ''}
                        </div>
                        <button onclick="addOption('${questionId}')" style="margin-top: 10px; padding: 8px 12px; background: #3182ce; color: white; border: none; border-radius: 6px; cursor: pointer;">Add Option</button>
                    </div>
                    <div class="correct-answers-container">
                        <label style="font-size: 14px; color: #4a5568;">Correct Answers:</label>
                        <div id="correct-answers-list-${questionId}" style="margin-top: 5px;">
                            ${question.correctAnswers ? question.correctAnswers.map(ans => `
                                <div class="correct-answer-item" style="display: flex; gap: 10px; margin-bottom: 5px;">
                                    <input type="text" value="${ans}" style="flex: 1; padding: 8px; border: 1px solid #cbd5e0; border-radius: 6px;" />
                                    <button onclick="this.closest('.correct-answer-item').remove()" style="padding: 8px; background: #e53e3e; color: white; border: none; border-radius: 6px; cursor: pointer;">Remove</button>
                                </div>
                            `).join('') : ''}
                        </div>
                        <button onclick="addCorrectAnswer('${questionId}')" style="margin-top: 10px; padding: 8px 12px; background: #3182ce; color: white; border: none; border-radius: 6px; cursor: pointer;">Add Correct Answer</button>
                    </div>
                </div>
            `;
            container.appendChild(questionBlock);
        });
    }
}

function p_savePeerSettings() {
    // Saves peer review settings to localStorage and opens the table modal
    const reviewerSelectionMethod = document.querySelector('.dropdown-select');
    const feedbackVisibility = document.querySelectorAll('.dropdown-select')[1];
    const assessmentFrequency = document.getElementById('f_assessment_frequency');
    const questions = [];

    document.querySelectorAll('#question-container .question-block').forEach((questionBlock, index) => {
        const questionId = questionBlock.id;
        const question = questionBlock.querySelector('textarea').value;
        const responseType = questionBlock.querySelector('select').value;
        const criteria = document.getElementById('active-criteria-title').textContent;
        const optionsList = document.getElementById(`options-list-${questionId}`);
        const options = optionsList ? Array.from(optionsList.children).map(opt => opt.textContent.replace('Delete', '').trim()) : [];
        const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
        const correctAnswers = correctAnswersList ? Array.from(correctAnswersList.children).map(ans => ans.textContent.replace('Delete', '').trim()) : [];

        questions.push({
            question: question,
            responseType: responseType,
            criteria: criteria,
            options: responseType === 'Multiple Choice' ? options : [],
            correctAnswers: responseType === 'Multiple Choice' ? correctAnswers : []
        });
    });

    if (reviewerSelectionMethod && feedbackVisibility && assessmentFrequency) {
        const peerSettings = {
            reviewerSelectionMethod: reviewerSelectionMethod.value,
            feedbackVisibility: feedbackVisibility.value,
            assessmentFrequency: assessmentFrequency.value,
            questions: questions
        };

        localStorage.setItem('peerSettings', JSON.stringify(peerSettings));
        p_openTableModal();
    } else {
        console.error("One or more elements not found");
    }
}

// Table for Peer Review Modal (id="p_table-modal-overlay")
// Purpose: Displays saved peer review settings in a tabular format.
// Functionality:
// - Shows reviewer selection method, feedback visibility, assessment frequency, criteria, response type, question text, options, and correct answers.
// - Includes status selection (Active, Delete, Deactivate, Reactivate) and checkboxes for selection.

function p_openTableModal() {
    // Opens the peer review table modal
    loadPeerSettings();
    document.getElementById("p_table-modal-overlay").style.display = "flex";
}

function p_closeTableModal() {
    // Closes the peer review table modal
    document.getElementById("p_table-modal-overlay").style.display = "none";
}

function loadPeerSettings() {
    // Loads and displays peer review settings in the table modal
    const peerSettings = JSON.parse(localStorage.getItem('peerSettings'));
    if (peerSettings) {
        const tableBody = document.getElementById("p_peerTableBody");
        tableBody.innerHTML = "";

        peerSettings.questions.forEach((question, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:150px;">
                    <select style="padding: 8px 12px; border: 1px solid #cbd5e0; border-radius: 8px; background: white; font-size: 14px; min-width: 120px;">
                        <option value="active" selected>Active</option>
                        <option value="delete">Delete</option>
                        <option value="deactivate">Deactivate</option>
                        <option value="reactivate">Reactivate</option>
                    </select>
                </td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${peerSettings.reviewerSelectionMethod}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${peerSettings.feedbackVisibility}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${peerSettings.assessmentFrequency}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.criteria}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.responseType}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:300px;">${question.question}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.options.join(', ') || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.correctAnswers.join(', ') || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:40px;">
                    <input type="checkbox" />
                </td>
            `;
            tableBody.appendChild(row);
        });
    }
}






// Feedback Settings Modal (id="feedbackModal")
// Purpose: Enables users to configure feedback questions categorized by Job Satisfaction, Work-Life Balance, and Growth & Development.
// Functionality:
// - Users can add questions to specific feedback categories with various response types (Rating Scale, Multiple Choice, Text Answer, True/False).
// - Questions are saved to localStorage and displayed in a table modal (f_retrieve-modal-overlay).
// - Includes modal opening/closing logic and focus trapping for accessibility.
// - Supports dynamic question addition and removal with animations.

function openModal(modalId) {
    // Generic function to open a modal with focus trapping
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden', 'false');
        document.addEventListener('keydown', trapFocus);
        const firstFocusable = modal.querySelector('button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (firstFocusable) firstFocusable.focus();
    } else {
        console.error(`Modal with ID ${modalId} not found`);
    }
}

function closeModal(modalId) {
    // Generic function to close a modal and remove focus trapping
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
        document.removeEventListener('keydown', trapFocus);
        // If closing table modal, focus back on feedback modal if open
        if (modalId === 'f_retrieve-modal-overlay') {
            const feedbackModal = document.getElementById('feedbackModal');
            if (feedbackModal && feedbackModal.style.display === 'flex') {
                const firstFocusable = feedbackModal.querySelector('button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
                if (firstFocusable) firstFocusable.focus();
            }
        }
    }
}

function trapFocus(event) {
    // Traps focus within the topmost modal for accessibility
    if (event.key === 'Tab' || event.keyCode === 9) {
        // Prioritize f_retrieve-modal-overlay if open
        const tableModal = document.querySelector('#f_retrieve-modal-overlay[style*="display: flex"]');
        const feedbackModal = document.querySelector('#feedbackModal[style*="display: flex"]');
        const modal = tableModal || feedbackModal;
        if (!modal) return;
        const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        const firstFocusableElement = focusableElements[0];
        const lastFocusableElement = focusableElements[focusableElements.length - 1];

        if (event.shiftKey) {
            if (document.activeElement === firstFocusableElement) {
                lastFocusableElement.focus();
                event.preventDefault();
            }
        } else {
            if (document.activeElement === lastFocusableElement) {
                firstFocusableElement.focus();
                event.preventDefault();
            }
        }
    }
}

function addQuestion(button) {
    // Adds a new feedback question to the specified container
    const section = button.closest('[style*="padding: 20px"]');
    const container = section.querySelector('.question-container');
    if (!container) {
        console.error('Question container not found');
        return;
    }
    const questionId = `feedback-question-${Date.now()}`;
    const newQuestion = document.createElement('div');
    newQuestion.className = 'question-block';
    newQuestion.id = questionId;
    newQuestion.style.cssText = "display: flex; flex-direction: column; gap: 12px; margin-bottom: 15px;";
    const questionCount = container.querySelectorAll('.question-block').length + 1;
    newQuestion.innerHTML = `
        <div style="display: flex; gap: 12px; margin-bottom: 15px; align-items: center;">
            <span class="question-number">${questionCount}.</span>
            <input type="text" 
                   placeholder="Enter question text" 
                   style="flex: 1; padding: 12px 16px; border: 1px solid #cbd5e0; border-radius: 8px; background: white; font-size: 15px;">
            <select style="padding: 12px 14px; border: 1px solid #cbd5e0; border-radius: 8px; background: white; font-size: 15px; min-width: 170px;" onchange="toggleMultipleChoiceOptions(this, '${questionId}')">
                <option>Rating Scale (1-5)</option>
                <option>Multiple Choice</option>
                <option>Text Answer</option>
                <option>True / False</option>
            </select>
            <button onclick="removeQuestion(this)" 
                    style="background: #e53e3e; color: white; border: none; border-radius: 8px; padding: 12px 16px; cursor: pointer; min-width: 40px; display: flex; justify-content: center; align-items: center;">
                <i class="fas fa-trash"></i>
            </button>
        </div>
        <div class="multiple-choice-options" id="mc-options-${questionId}" style="display: none; width: 100%; margin-top: 15px;">
            <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
                <input type="text" id="option-input-${questionId}" placeholder="Enter option" style="flex: 1; padding: 12px 14px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; font-size: 14px;">
                <button onclick="addOption(this, '${questionId}')" style="background: #4f46e5; color: white; border: none; border-radius: 8px; padding: 0 20px; cursor: pointer; font-weight: 500;">
                    Add Option
                </button>
            </div>
            <div class="options-list" id="options-list-${questionId}" style="width: 100%; margin-bottom: 20px;"></div>
            <div class="correct-answers-container" style="width: 100%;">
                <label style="font-size: 15px; color: #4a5568; font-weight: 500; margin-bottom: 12px; display: block;">Correct Answers:</label>
                <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
                    <input type="text" id="correct-answer-input-${questionId}" placeholder="Enter correct answer" style="flex: 1; padding: 12px 14px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; font-size: 14px;">
                    <button onclick="addCorrectAnswer(this, '${questionId}')" style="background: #10b981; color: white; border: none; border-radius: 8px; padding: 0 20px; cursor: pointer; font-weight: 500;">
                        Add Answer
                    </button>
                </div>
                <div class="correct-answers-list" id="correct-answers-list-${questionId}" style="width: 100%;"></div>
                <div class="correct-answers-textbox-container" id="correct-answers-textbox-${questionId}"></div>
            </div>
            <button onclick="setOptionsAndCorrectAnswers(this, '${questionId}')" style="margin-top: 15px; background: #4f46e5; color: white; border: none; border-radius: 10px; padding: 12px 24px; cursor: pointer; font-weight: 500;">
                Save Options
            </button>
        </div>
        <input type="hidden" name="options-${questionId}" value="[]">
        <input type="hidden" name="correct-answers-${questionId}" value="[]">
    `;
    container.appendChild(newQuestion);
}

function removeQuestion(button) {
    // Removes a feedback question with a fade-out animation
    const questionBlock = button.closest('.question-block');
    if (questionBlock) {
        questionBlock.style.transition = 'all 0.3s ease-out';
        questionBlock.style.opacity = '0';
        questionBlock.style.transform = 'translateY(-20px)';
        setTimeout(() => {
            const questionList = questionBlock.parentNode;
            questionBlock.remove();
            Array.from(questionList.querySelectorAll('.question-block')).forEach((block, index) => {
                const numberSpan = block.querySelector('.question-number');
                if (numberSpan) numberSpan.textContent = `${index + 1}.`;
            });
        }, 300);
    }
}

function toggleMultipleChoiceOptions(select, questionId) {
    // Toggles visibility of multiple-choice options section
    const mcOptions = document.getElementById(`mc-options-${questionId}`);
    if (mcOptions) {
        mcOptions.style.display = select.value === 'Multiple Choice' ? 'block' : 'none';
    }
}

function addOption(button, questionId) {
    // Adds an option to the options list
    const input = document.getElementById(`option-input-${questionId}`);
    const optionsList = document.getElementById(`options-list-${questionId}`);
    if (input && optionsList && input.value.trim()) {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option-item';
        optionDiv.innerHTML = `${input.value.trim()} <button onclick="this.parentNode.remove()" class="delete-option-btn">Delete</button>`;
        optionsList.appendChild(optionDiv);
        input.value = '';
    }
}

function addCorrectAnswer(button, questionId) {
    // Adds a correct answer to the correct answers list
    const input = document.getElementById(`correct-answer-input-${questionId}`);
    const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
    if (input && correctAnswersList && input.value.trim()) {
        const answerDiv = document.createElement('div');
        answerDiv.className = 'correct-answer-item';
        answerDiv.innerHTML = `${input.value.trim()} <button onclick="this.parentNode.remove()" class="delete-answer-btn">Delete</button>`;
        correctAnswersList.appendChild(answerDiv);
        input.value = '';
    }
}

function setOptionsAndCorrectAnswers(button, questionId) {
    // Saves options and correct answers to hidden inputs
    const optionsList = document.getElementById(`options-list-${questionId}`);
    const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
    const questionBlock = document.getElementById(questionId);
    if (!optionsList || !correctAnswersList || !questionBlock) {
        console.warn(`Elements for questionId ${questionId} not found`);
        return;
    }
    const options = Array.from(optionsList.children).map(opt => opt.textContent.replace('Delete', '').trim()).filter(opt => opt);
    const correctAnswers = Array.from(correctAnswersList.children).map(ans => ans.textContent.replace('Delete', '').trim()).filter(ans => ans);
    let optionsInput = questionBlock.querySelector(`input[name="options-${questionId}"]`);
    if (!optionsInput) {
        optionsInput = document.createElement('input');
        optionsInput.type = 'hidden';
        optionsInput.name = `options-${questionId}`;
        questionBlock.appendChild(optionsInput);
    }
    optionsInput.value = JSON.stringify(options);
    let correctAnswersInput = questionBlock.querySelector(`input[name="correct-answers-${questionId}"]`);
    if (!correctAnswersInput) {
        correctAnswersInput = document.createElement('input');
        correctAnswersInput.type = 'hidden';
        correctAnswersInput.name = `correct-answers-${questionId}`;
        questionBlock.appendChild(correctAnswersInput);
    }
    correctAnswersInput.value = JSON.stringify(correctAnswers);
    alert('Options and correct answers saved for this question!');
}

function f_saveFeedbackSettings() {
    // Saves feedback assessment settings to localStorage and opens the table modal
    try {
        const targetGroup = document.querySelector('#f_target_group select')?.value || '';
        const targetedIndividuals = Array.from(document.querySelectorAll('#f_targeted_individuals_select option:checked')).map(opt => opt.textContent.trim());
        const feedbackVisibility = document.querySelector('#f_feedback_visibility select')?.value || '';
        const assessmentFrequency = document.getElementById('f_assessment_frequency')?.value || '';
        const assessmentDate = document.getElementById('f_assessment_date')?.value || '';
        const questions = [];

        ['jobSatisfactionQuestions', 'workLifeBalanceQuestions', 'growthDevelopmentQuestions'].forEach(containerId => {
            const container = document.getElementById(containerId);
            if (container) {
                container.querySelectorAll('.question-block').forEach((questionBlock, index) => {
                    const questionId = questionBlock.id;
                    const questionText = questionBlock.querySelector('input[type="text"]')?.value.trim();
                    const questionType = questionBlock.querySelector('select')?.value;
                    const feedbackAspect = containerId === 'jobSatisfactionQuestions' ? 'Job Satisfaction' :
                                          containerId === 'workLifeBalanceQuestions' ? 'Work-Life Balance' :
                                          'Growth & Development';
                    const optionsInput = questionBlock.querySelector(`input[name="options-${questionId}"]`);
                    const correctAnswersInput = questionBlock.querySelector(`input[name="correct-answers-${questionId}"]`);
                    const options = optionsInput ? JSON.parse(optionsInput.value || '[]') : [];
                    const correctAnswers = correctAnswersInput ? JSON.parse(correctAnswersInput.value || '[]') : [];
                    if (questionText) {
                        questions.push({
                            questionText,
                            questionType,
                            feedbackAspect,
                            options: questionType === 'Multiple Choice' ? options : [],
                            correctAnswers: questionType === 'Multiple Choice' ? correctAnswers : [],
                            status: 'active',
                            questionNumber: index + 1
                        });
                    }
                });
            } else {
                console.warn(`Container with ID ${containerId} not found`);
            }
        });

        const feedbackSettings = {
            targetGroup,
            targetedIndividuals,
            feedbackVisibility,
            assessmentFrequency,
            assessmentDate,
            questions
        };

        localStorage.setItem('f_feedbackSettings', JSON.stringify(feedbackSettings));
        f_loadTableSettings();
        f_openTableModal();
        alert('Feedback assessment configuration saved successfully!');
    } catch (error) {
        console.error('Error in f_saveFeedbackSettings:', error);
        alert('An error occurred while saving feedback settings. Please check the console for details.');
    }
}

function f_retrieveSettings() {
    // Retrieves and loads saved settings into the feedback modal
    f_loadFeedbackSettings();
    openModal('feedbackModal');
}

function f_loadFeedbackSettings(settings = null) {
    // Loads and displays feedback assessment settings in the modal
    try {
        const data = settings || JSON.parse(localStorage.getItem('f_feedbackSettings'));
        if (data) {
            const targetGroupSelect = document.querySelector('#f_target_group select');
            if (targetGroupSelect && data.targetGroup) targetGroupSelect.value = data.targetGroup;

            const targetedIndividualsSelect = document.getElementById('f_targeted_individuals_select');
            if (targetedIndividualsSelect && data.targetedIndividuals) {
                Array.from(targetedIndividualsSelect.options).forEach(option => {
                    option.selected = data.targetedIndividuals.includes(option.textContent.trim());
                });
            }

            const feedbackVisibilitySelect = document.querySelector('#f_feedback_visibility select');
            if (feedbackVisibilitySelect && data.feedbackVisibility) feedbackVisibilitySelect.value = data.feedbackVisibility;

            const assessmentFrequencySelect = document.getElementById('f_assessment_frequency');
            if (assessmentFrequencySelect && data.assessmentFrequency) assessmentFrequencySelect.value = data.assessmentFrequency;

            const assessmentDateInput = document.getElementById('f_assessment_date');
            if (assessmentDateInput && data.assessmentDate) assessmentDateInput.value = data.assessmentDate;

            ['jobSatisfactionQuestions', 'workLifeBalanceQuestions', 'growthDevelopmentQuestions'].forEach(containerId => {
                const container = document.getElementById(containerId);
                if (container) container.innerHTML = '';
            });

            const questionsToLoad = data.questions || [];
            questionsToLoad.forEach((question, index) => {
                const containerId = question.feedbackAspect === 'Job Satisfaction' ? 'jobSatisfactionQuestions' :
                                   question.feedbackAspect === 'Work-Life Balance' ? 'workLifeBalanceQuestions' :
                                   'growthDevelopmentQuestions';
                const questionList = document.getElementById(containerId);
                if (!questionList) {
                    console.warn(`Container with ID ${containerId} not found`);
                    return;
                }
                const questionId = `feedback-question-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block';
                questionBlock.id = questionId;
                questionBlock.style.cssText = "display: flex; flex-direction: column; gap: 12px; margin-bottom: 15px;";
                questionBlock.innerHTML = `
                    <div style="display: flex; gap: 12px; margin-bottom: 15px; align-items: center;">
                        <span class="question-number">${index + 1}.</span>
                        <input type="text" value="${question.questionText}" style="flex: 1; padding: 12px 16px; border: 1px solid #cbd5e0; border-radius: 8px; background: white; font-size: 15px;">
                        <select style="padding: 12px 14px; border: 1px solid #cbd5e0; border-radius: 8px; background: white; font-size: 15px; min-width: 170px;" onchange="toggleMultipleChoiceOptions(this, '${questionId}')">
                            <option value="Rating Scale (1-5)" ${question.questionType === 'Rating Scale (1-5)' ? 'selected' : ''}>Rating Scale (1-5)</option>
                            <option value="Multiple Choice" ${question.questionType === 'Multiple Choice' ? 'selected' : ''}>Multiple Choice</option>
                            <option value="Text Answer" ${question.questionType === 'Text Answer' ? 'selected' : ''}>Text Answer</option>
                            <option value="True / False" ${question.questionType === 'True / False' ? 'selected' : ''}>True / False</option>
                        </select>
                        <button onclick="removeQuestion(this)" style="background: #e53e3e; color: white; border: none; border-radius: 8px; padding: 12px 16px; cursor: pointer; min-width: 40px; display: flex; justify-content: center; align-items: center;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="multiple-choice-options" id="mc-options-${questionId}" style="display: ${question.questionType === 'Multiple Choice' ? 'block' : 'none'}; width: 100%; margin-top: 15px;">
                        <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
                            <input type="text" id="option-input-${questionId}" placeholder="Enter option" style="flex: 1; padding: 12px 14px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; font-size: 14px;">
                            <button onclick="addOption(this, '${questionId}')" style="background: #4f46e5; color: white; border: none; border-radius: 8px; padding: 0 20px; cursor: pointer; font-weight: 500;">
                                Add Option
                            </button>
                        </div>
                        <div class="options-list" id="options-list-${questionId}" style="width: 100%; margin-bottom: 20px;">
                            ${question.options.map(opt => `<div class="option-item">${opt} <button onclick="this.parentNode.remove()" class="delete-option-btn">Delete</button></div>`).join('')}
                        </div>
                        <div class="correct-answers-container" style="width: 100%;">
                            <label style="font-size: 15px; color: #4a5568; font-weight: 500; margin-bottom: 12px; display: block;">Correct Answers:</label>
                            <div class="option-container" style="display: flex; gap: 12px; width: 100%; margin-bottom: 15px;">
                                <input type="text" id="correct-answer-input-${questionId}" placeholder="Enter correct answer" style="flex: 1; padding: 12px 14px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; font-size: 14px;">
                                <button onclick="addCorrectAnswer(this, '${questionId}')" style="background: #10b981; color: white; border: none; border-radius: 8px; padding: 0 20px; cursor: pointer; font-weight: 500;">
                                    Add Answer
                                </button>
                            </div>
                            <div class="correct-answers-list" id="correct-answers-list-${questionId}" style="width: 100;">
                                ${question.correctAnswers.map(ans => `<div class="correct-answer-item">${ans} <button onclick="this.parentNode.remove()" class="delete-answer-btn">Delete</button></div>`).join('')}
                            </div>
                            <div class="correct-answers-textbox-container" id="correct-answers-textbox-${questionId}"></div>
                        </div>
                        <button onclick="setOptionsAndCorrectAnswers(this, '${questionId}')" style="margin-top: 15px; background: #4f46e5; color: white; border: none; border-radius: 10px; padding: 12px 24px; cursor: pointer; font-weight: 500;">
                            Save Options
                        </button>
                    </div>
                    <input type="hidden" name="options-${questionId}" value='${JSON.stringify(question.options)}'>
                    <input type="hidden" name="correct-answers-${questionId}" value='${JSON.stringify(question.correctAnswers)}'>
                `;
                questionList.appendChild(questionBlock);
            });
        }
    } catch (error) {
        console.error('Error in f_loadFeedbackSettings:', error);
        alert('An error occurred while loading feedback settings. Please check the console for details.');
    }
}

function f_openTableModal() {
    // Opens the feedback assessment table modal, keeping feedbackModal open
    const modal = document.getElementById('f_retrieve-modal-overlay');
    if (modal) {
        modal.style.display = 'flex';
        modal.style.zIndex = '1050';
        document.addEventListener('keydown', trapFocus);
        const firstFocusable = modal.querySelector('button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (firstFocusable) firstFocusable.focus();
    } else {
        console.error('Table modal (f_retrieve-modal-overlay) not found');
    }
}

function f_closeTableModal() {
    // Closes the feedback assessment table modal
    closeModal('f_retrieve-modal-overlay');
}

function f_loadTableSettings() {
    // Loads and displays feedback assessment settings in the table modal
    try {
        const settings = JSON.parse(localStorage.getItem('f_feedbackSettings'));
        const tableBody = document.getElementById('f_feedbackTableBody');
        if (!tableBody) {
            console.error('Table body (f_feedbackTableBody) not found');
            return;
        }
        tableBody.innerHTML = '';
        if (settings && settings.questions) {
            settings.questions.forEach((question, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:150px;">
                        <select style="padding: 8px 12px; border: 1px solid #cbd5e0; border-radius: 8px; background: white; font-size: 14px; min-width: 120px;">
                            <option value="active" ${question.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="delete">Delete</option>
                            <option value="deactivate" ${question.status === 'deactivate' ? 'selected' : ''}>Deactivate</option>
                            <option value="reactivate" ${question.status === 'reactivate' ? 'selected' : ''}>Reactivate</option>
                        </select>
                    </td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${settings.targetGroup || ''}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${settings.targetedIndividuals?.join(', ') || ''}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${settings.feedbackVisibility || ''}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${settings.assessmentFrequency || ''}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${settings.assessmentDate || ''}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.feedbackAspect}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.questionType}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${question.questionNumber}. ${question.questionText}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.options.join(', ') || ''}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.correctAnswers.join(', ') || ''}</td>
                    <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;text-align:left;vertical-align:middle;width:40px;">
                        <input type="checkbox" />
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
    } catch (error) {
        console.error('Error in f_loadTableSettings:', error);
        alert('An error occurred while loading table settings. Please check the console for details.');
    }
}

function f_deleteSelectedRows() {
    // Deletes checked rows from the table UI (not saved to localStorage until Save is clicked)
    const tableBody = document.getElementById('f_feedbackTableBody');
    if (!tableBody) {
        console.error('Table body (f_feedbackTableBody) not found');
        return;
    }
    const checkedRows = Array.from(tableBody.querySelectorAll('tr input[type="checkbox"]:checked'));
    if (checkedRows.length === 0) {
        alert('Please select at least one row to delete.');
        return;
    }
    checkedRows.forEach(checkbox => {
        const row = checkbox.closest('tr');
        row.style.transition = 'all 0.3s ease-out';
        row.style.opacity = '0';
        row.style.transform = 'translateY(-20px)';
        setTimeout(() => row.remove(), 300);
    });
    alert('Selected rows deleted from the table. Click "Save" to persist changes.');
}

function f_updateSelectedRow() {
    // Loads the first checked row's data into feedbackModal for editing
    const tableBody = document.getElementById('f_feedbackTableBody');
    if (!tableBody) {
        console.error('Table body (f_feedbackTableBody) not found');
        return;
    }
    const checkedRows = Array.from(tableBody.querySelectorAll('tr input[type="checkbox"]:checked'));
    if (checkedRows.length === 0) {
        alert('Please select a row to update.');
        return;
    }
    const row = checkedRows[0].closest('tr');
    const settings = JSON.parse(localStorage.getItem('f_feedbackSettings')) || {};
    const rowIndex = Array.from(tableBody.children).indexOf(row);
    const question = settings.questions[rowIndex];
    if (!question) {
        console.error('Selected question not found in settings');
        return;
    }
    const updatedSettings = {
        targetGroup: row.children[1].textContent,
        targetedIndividuals: row.children[2].textContent ? row.children[2].textContent.split(', ') : [],
        feedbackVisibility: row.children[3].textContent,
        assessmentFrequency: row.children[4].textContent,
        assessmentDate: row.children[5].textContent,
        questions: [question]
    };
    f_loadFeedbackSettings(updatedSettings);
    closeModal('f_retrieve-modal-overlay');
    openModal('feedbackModal');
}

// Event listeners
document.addEventListener('DOMContentLoaded', function() {
    const feedbackTile = document.getElementById('feedbackTile');
    if (feedbackTile) {
        feedbackTile.addEventListener('click', function() {
            openModal('feedbackModal');
        });
    } else {
        console.warn('Feedback tile (feedbackTile) not found');
    }

    const saveButton = document.getElementById('f_save');
    if (saveButton) {
        saveButton.removeAttribute('onclick');
        saveButton.addEventListener('click', function(event) {
            event.preventDefault();
            f_saveFeedbackSettings();
        });
    } else {
        console.warn('Save button (f_save) not found');
    }

    const retrieveButton = document.getElementById('f_retrieve');
    if (retrieveButton) {
        retrieveButton.addEventListener('click', function(event) {
            event.preventDefault();
            f_retrieveSettings();
        });
    } else {
        console.warn('Retrieve button (f_retrieve) not found');
    }

    const updateButton = document.getElementById('f_updateFeedbackBtn');
    if (updateButton) {
        updateButton.addEventListener('click', function(event) {
            event.preventDefault();
            const tableBody = document.getElementById('f_feedbackTableBody');
            if (!tableBody) {
                console.error('Table body (f_feedbackTableBody) not found');
                return;
            }
            const settings = JSON.parse(localStorage.getItem('f_feedbackSettings')) || {
                targetGroup: document.querySelector('#f_target_group select')?.value || '',
                targetedIndividuals: Array.from(document.querySelectorAll('#f_targeted_individuals_select option:checked')).map(opt => opt.textContent.trim()),
                feedbackVisibility: document.querySelector('#f_feedback_visibility select')?.value || '',
                assessmentFrequency: document.getElementById('f_assessment_frequency')?.value || '',
                assessmentDate: document.getElementById('f_assessment_date')?.value || '',
                questions: []
            };
            const updatedQuestions = [];
            Array.from(tableBody.children).forEach((row, index) => {
                const status = row.querySelector('select').value;
                if (status !== 'delete') {
                    const questionTextWithNumber = row.children[8].textContent;
                    const questionText = questionTextWithNumber.replace(/^\d+\.\s*/, '');
                    updatedQuestions.push({
                        questionText,
                        questionType: row.children[7].textContent,
                        feedbackAspect: row.children[6].textContent,
                        options: row.children[9].textContent ? row.children[9].textContent.split(', ') : [],
                        correctAnswers: row.children[10].textContent ? row.children[10].textContent.split(', ') : [],
                        status: status,
                        questionNumber: index + 1
                    });
                }
            });
            settings.questions = updatedQuestions;
            localStorage.setItem('f_feedbackSettings', JSON.stringify(settings));
            f_loadTableSettings();
            alert('Feedback settings saved successfully!');
        });
    } else {
        console.warn('Update button (f_updateFeedbackBtn) not found');
    }

    const deleteButton = document.getElementById('f_deleteRowsBtn');
    if (deleteButton) {
        deleteButton.addEventListener('click', function(event) {
            event.preventDefault();
            f_deleteSelectedRows();
        });
    } else {
        console.warn('Delete button (f_deleteRowsBtn) not found');
    }

    const updateRowButton = document.getElementById('f_updateRowBtn');
    if (updateRowButton) {
        updateRowButton.addEventListener('click', function(event) {
            event.preventDefault();
            f_updateSelectedRow();
        });
    } else {
        console.warn('Update row button (f_updateRowBtn) not found');
    }

    const tableModal = document.getElementById('f_retrieve-modal-overlay');
    if (tableModal) {
        tableModal.addEventListener('click', function(event) {
            if (event.target === this) {
                f_closeTableModal();
            }
        });
    } else {
        console.warn('Table modal (f_retrieve-modal-overlay) not found');
    }
});



// Manager Assessment Modal (id="managerModal")
// Purpose: Allows configuration of manager assessment questions across predefined competence areas (e.g., Communication Skills, Managing Multigenerational Teams).
// Functionality:
// - Users configure target group, targeted individuals, feedback visibility, assessment frequency, date, and questions.
// - Questions are saved to localStorage and displayed in a table modal (m_retrieve-modal-overlay).
// - Includes animations, button disabling for selected areas, and focus trapping for accessibility.

function closeModal(modalId) {
    // Closes the specified modal
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';
    }
}


function createManagerCompetenceArea(competence) {
    // Creates a new competence area for manager assessment questions
    const container = document.getElementById('m_competence-container');
    const buttonsContainer = document.getElementById('m_competence-buttons');
    const existingSection = Array.from(container.children).find(section => 
        section.querySelector('h5')?.textContent === competence
    );

    if (existingSection) {
        return; // Prevent creating duplicate section
    }

    const button = Array.from(buttonsContainer.querySelectorAll('button')).find(btn => 
        btn.textContent.includes(competence)
    );
    if (button) {
        button.disabled = true;
        button.style.opacity = '0.5';
        button.style.cursor = 'not-allowed';
    }

    const section = document.createElement('div');
    section.id = 'area-' + competence.replace(/\s+/g, '');
    section.style.cssText = 'background: rgba(26, 187, 156, 0.08); border-radius: 12px; padding: 20px; margin-bottom: 25px; border-left: 4px solid #1ABB9C;';
    
    const colors = {
        'Communication Skills': { bg: '#1ABB9C', text: '#1a936f' },
        'Managing Multigenerational Teams': { bg: '#d69e2e', text: '#b7791f' },
        'Performance Feedback': { bg: '#4299e1', text: '#2b6cb0' },
        'Career Development Support': { bg: '#f56565', text: '#c53030' },
        'Strengths-Based Leadership': { bg: '#9f7aea', text: '#6b46c1' },
        'Change Advocacy': { bg: '#48bb78', text: '#2f855a' }
    };

    const { bg, text } = colors[competence] || colors['Communication Skills'];

    section.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h5 style="font-size: 1.2rem; color: ${text}; display: flex; align-items: center;">
                <i class="fas fa-${competence === 'Communication Skills' ? 'comments' : competence === 'Managing Multigenerational Teams' ? 'users' : competence === 'Performance Feedback' ? 'chart-line' : competence === 'Career Development Support' ? 'briefcase' : competence === 'Strengths-Based Leadership' ? 'chess-queen' : 'exchange-alt'}" style="margin-right: 10px;"></i>${competence}
            </h5>
            <button onclick="addManagerQuestion('${competence.toLowerCase().replace(/ /g, '-')}-questions')" style="background: ${bg}; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 14px; display: flex; align-items: center; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.2)'" onmouseout="this.style.transform='none'; this.style.boxShadow='none'">
                <i class="fas fa-plus" style="margin-right: 6px;"></i>Add Question
            </button>
        </div>
        <div class="question-list" id="${competence.toLowerCase().replace(/ /g, '-')}-questions" style="display: flex; flex-direction: column; gap: 20px;"></div>
    `;
    container.appendChild(section);
}

function addManagerQuestion(containerId) {
    // Adds a new manager assessment question to the specified competence area
    const questionList = document.getElementById(containerId);
    if (!questionList) {
        console.warn(`Question list with ID ${containerId} not found`);
        return;
    }

    // Calculate question number based on existing questions in the container
    const questionCount = questionList.querySelectorAll('.question-block').length + 1;
    const questionId = `question-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    const questionBlock = document.createElement('div');
    questionBlock.className = 'question-block';
    questionBlock.id = questionId;

    questionBlock.innerHTML = `
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <span class="question-number">${questionCount}.</span>
            <textarea placeholder="Enter your manager assessment question..." class="question-textarea"></textarea>
            <button onclick="removeManagerQuestion('${questionId}')" class="remove-question-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="response-type-container">
            <label>Response Type:</label>
            <select onchange="toggleMultipleChoiceOptions(this, '${questionId}')">
                <option value="Text Response">Text Response</option>
                <option value="Rating (1-5)">Rating (1-5)</option>
                <option value="Yes/No">Yes/No</option>
                <option value="Percentage (0-100%)">Percentage (0-100%)</option>
                <option value="Multiple Choice">Multiple Choice</option>
            </select>
        </div>
        <div class="multiple-choice-options" id="mc-options-${questionId}" style="display: none;">
            <div class="option-container">
                <input type="text" id="option-input-${questionId}" placeholder="Enter option">
                <button onclick="addOption(this, '${questionId}')" class="add-option-btn">Add Option</button>
            </div>
            <div class="options-list" id="options-list-${questionId}"></div>
            <div class="correct-answers-container">
                <label>Correct Answers:</label>
                <div class="option-container">
                    <input type="text" id="correct-answer-input-${questionId}" placeholder="Enter correct answer">
                    <button onclick="addCorrectAnswer(this, '${questionId}')" class="add-answer-btn">Add Answer</button>
                </div>
                <div class="correct-answers-list" id="correct-answers-list-${questionId}"></div>
                <div class="correct-answers-textbox-container" id="correct-answers-textbox-${questionId}"></div>
            </div>
            <button onclick="setOptionsAndCorrectAnswers(this, '${questionId}')" class="save-options-btn">Save Options</button>
        </div>
    `;

    questionList.appendChild(questionBlock);
}

function removeManagerQuestion(questionId) {
    // Removes a manager assessment question with a fade-out animation
    const questionBlock = document.getElementById(questionId);
    if (questionBlock) {
        questionBlock.style.transition = 'all 0.3s ease-out';
        questionBlock.style.opacity = '0';
        questionBlock.style.transform = 'translateY(-20px)';
        setTimeout(() => {
            const questionList = questionBlock.parentNode;
            questionBlock.remove();
            // Update numbering for remaining questions in the same container
            Array.from(questionList.querySelectorAll('.question-block')).forEach((block, index) => {
                const numberSpan = block.querySelector('.question-number');
                if (numberSpan) {
                    numberSpan.textContent = `${index + 1}.`;
                }
            });
        }, 300);
    }
}

function toggleMultipleChoiceOptions(select, questionId) {
    // Toggles visibility of multiple-choice options section
    const mcOptions = document.getElementById(`mc-options-${questionId}`);
    if (mcOptions) {
        mcOptions.style.display = select.value === 'Multiple Choice' ? 'block' : 'none';
    }
}

function addOption(button, questionId) {
    // Adds an option to the options list
    const input = document.getElementById(`option-input-${questionId}`);
    const optionsList = document.getElementById(`options-list-${questionId}`);
    if (input && optionsList && input.value.trim()) {
        const optionDiv = document.createElement('div');
        optionDiv.className = 'option-item';
        optionDiv.innerHTML = `
            ${input.value.trim()}
            <button onclick="this.parentNode.remove()" class="delete-option-btn">Delete</button>
        `;
        optionsList.appendChild(optionDiv);
        input.value = ''; // Clear input
    }
}

function addCorrectAnswer(button, questionId) {
    // Adds a correct answer to the correct answers list
    const input = document.getElementById(`correct-answer-input-${questionId}`);
    const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
    if (input && correctAnswersList && input.value.trim()) {
        const answerDiv = document.createElement('div');
        answerDiv.className = 'correct-answer-item';
        answerDiv.innerHTML = `
            ${input.value.trim()}
            <button onclick="this.parentNode.remove()" class="delete-answer-btn">Delete</button>
        `;
        correctAnswersList.appendChild(answerDiv);
        input.value = ''; // Clear input
    }
}

function setOptionsAndCorrectAnswers(button, questionId) {
    // Saves options and correct answers to hidden inputs for persistence
    const optionsList = document.getElementById(`options-list-${questionId}`);
    const correctAnswersList = document.getElementById(`correct-answers-list-${questionId}`);
    const questionBlock = document.getElementById(questionId);
    
    if (!optionsList || !correctAnswersList || !questionBlock) {
        console.warn(`Elements for questionId ${questionId} not found`);
        return;
    }

    const options = Array.from(optionsList.children)
        .map(opt => opt.textContent.replace('Delete', '').trim())
        .filter(opt => opt);
    const correctAnswers = Array.from(correctAnswersList.children)
        .map(ans => ans.textContent.replace('Delete', '').trim())
        .filter(ans => ans);

    // Store options and correct answers in hidden inputs
    let optionsInput = questionBlock.querySelector(`input[name="options-${questionId}"]`);
    if (!optionsInput) {
        optionsInput = document.createElement('input');
        optionsInput.type = 'hidden';
        optionsInput.name = `options-${questionId}`;
        questionBlock.appendChild(optionsInput);
    }
    optionsInput.value = JSON.stringify(options);

    let correctAnswersInput = questionBlock.querySelector(`input[name="correct-answers-${questionId}"]`);
    if (!correctAnswersInput) {
        correctAnswersInput = document.createElement('input');
        correctAnswersInput.type = 'hidden';
        correctAnswersInput.name = `correct-answers-${questionId}`;
        questionBlock.appendChild(correctAnswersInput);
    }
    correctAnswersInput.value = JSON.stringify(correctAnswers);

    alert('Options and correct answers saved for this question!');
}

function m_saveManagerSettings() {
    // Saves manager assessment settings to localStorage and opens the table modal
    const targetGroup = document.querySelector('#m_target_group select')?.value || '';
    const targetedIndividuals = Array.from(document.querySelectorAll('#m_targeted_individuals_select option:checked'))
        .map(opt => opt.textContent.trim());
    const feedbackVisibility = document.querySelector('#m_feedback_visibility select')?.value || '';
    const assessmentFrequency = document.getElementById('m_assessment_frequency')?.value || '';
    const assessmentDate = document.getElementById('m_assessment_date')?.value || '';
    const questions = [];

    ['communication-skills-questions', 'managing-multigenerational-teams-questions', 'performance-feedback-questions', 'career-development-support-questions', 'strengths-based-leadership-questions', 'change-advocacy-questions'].forEach(containerId => {
        const container = document.getElementById(containerId);
        if (container) {
            container.querySelectorAll('.question-block').forEach((questionBlock, index) => {
                const questionId = questionBlock.id;
                const questionText = questionBlock.querySelector('textarea')?.value.trim();
                const questionType = questionBlock.querySelector('select')?.value;
                const competenceArea = containerId.split('-questions')[0].split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');

                // Retrieve options and correct answers from hidden inputs
                const optionsInput = questionBlock.querySelector(`input[name="options-${questionId}"]`);
                const correctAnswersInput = questionBlock.querySelector(`input[name="correct-answers-${questionId}"]`);
                const options = optionsInput ? JSON.parse(optionsInput.value || '[]') : [];
                const correctAnswers = correctAnswersInput ? JSON.parse(correctAnswersInput.value || '[]') : [];

                if (questionText) {
                    questions.push({
                        questionText,
                        questionType,
                        competenceArea,
                        options: questionType === 'Multiple Choice' ? options : [],
                        correctAnswers: questionType === 'Multiple Choice' ? correctAnswers : [],
                        status: 'active',
                        questionNumber: index + 1 // Store question number
                    });
                }
            });
        }
    });

    const managerSettings = {
        targetGroup,
        targetedIndividuals,
        feedbackVisibility,
        assessmentFrequency,
        assessmentDate,
        questions
    };

    localStorage.setItem('m_managerSettings', JSON.stringify(managerSettings));
    m_loadTableSettings();
    m_openTableModal();
    alert('Manager assessment configuration saved successfully!');
}

function m_retrieveSettings() {
    // Retrieves and loads saved settings into the manager modal
    m_loadManagerSettings();
}

function m_loadManagerSettings() {
    // Loads and displays manager assessment settings in the competence container
    const settings = JSON.parse(localStorage.getItem('m_managerSettings'));
    if (settings) {
        // Populate dropdowns and inputs
        const targetGroupSelect = document.querySelector('#m_target_group select');
        if (targetGroupSelect && settings.targetGroup) {
            targetGroupSelect.value = settings.targetGroup;
        }

        const targetedIndividualsSelect = document.getElementById('m_targeted_individuals_select');
        if (targetedIndividualsSelect && settings.targetedIndividuals) {
            Array.from(targetedIndividualsSelect.options).forEach(option => {
                option.selected = settings.targetedIndividuals.includes(option.textContent.trim());
            });
        }

        const feedbackVisibilitySelect = document.querySelector('#m_feedback_visibility select');
        if (feedbackVisibilitySelect && settings.feedbackVisibility) {
            feedbackVisibilitySelect.value = settings.feedbackVisibility;
        }

        const assessmentFrequencySelect = document.getElementById('m_assessment_frequency');
        if (assessmentFrequencySelect && settings.assessmentFrequency) {
            assessmentFrequencySelect.value = settings.assessmentFrequency;
        }

        const assessmentDateInput = document.getElementById('m_assessment_date');
        if (assessmentDateInput && settings.assessmentDate) {
            assessmentDateInput.value = settings.assessmentDate;
        }

        // Populate competence areas and questions
        const container = document.getElementById('m_competence-container');
        const buttonsContainer = document.getElementById('m_competence-buttons');
        container.innerHTML = ''; // Clear existing sections

        buttonsContainer?.querySelectorAll('button').forEach(button => {
            button.disabled = false;
            button.style.opacity = '1';
            button.style.cursor = 'pointer';
        });

        const areas = [
            'Communication Skills',
            'Managing Multigenerational Teams',
            'Performance Feedback',
            'Career Development Support',
            'Strengths-Based Leadership',
            'Change Advocacy'
        ];

        areas.forEach(area => {
            const areaQuestions = settings.questions?.filter(q => q.competenceArea === area) || [];
            if (areaQuestions.length > 0) {
                createManagerCompetenceArea(area);
                const questionList = document.getElementById(`${area.toLowerCase().replace(/ /g, '-')}-questions`);
                areaQuestions.forEach((question, index) => {
                    const questionId = `question-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                    const questionBlock = document.createElement('div');
                    questionBlock.className = 'question-block';
                    questionBlock.id = questionId;

                    questionBlock.innerHTML = `
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <span class="question-number">${index + 1}.</span>
                            <textarea placeholder="Enter your manager assessment question..." class="question-textarea">${question.questionText}</textarea>
                            <button onclick="removeManagerQuestion('${questionId}')" class="remove-question-btn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="response-type-container">
                            <label>Response Type:</label>
                            <select onchange="toggleMultipleChoiceOptions(this, '${questionId}')">
                                <option value="Text Response" ${question.questionType === 'Text Response' ? 'selected' : ''}>Text Response</option>
                                <option value="Rating (1-5)" ${question.questionType === 'Rating (1-5)' ? 'selected' : ''}>Rating (1-5)</option>
                                <option value="Yes/No" ${question.questionType === 'Yes/No' ? 'selected' : ''}>Yes/No</option>
                                <option value="Percentage (0-100%)" ${question.questionType === 'Percentage (0-100%)' ? 'selected' : ''}>Percentage (0-100%)</option>
                                <option value="Multiple Choice" ${question.questionType === 'Multiple Choice' ? 'selected' : ''}>Multiple Choice</option>
                            </select>
                        </div>
                        <div class="multiple-choice-options" id="mc-options-${questionId}" style="display: ${question.questionType === 'Multiple Choice' ? 'block' : 'none'};">
                            <div class="option-container">
                                <input type="text" id="option-input-${questionId}" placeholder="Enter option">
                                <button onclick="addOption(this, '${questionId}')" class="add-option-btn">Add Option</button>
                            </div>
                            <div class="options-list" id="options-list-${questionId}">
                                ${question.options.map(opt => `
                                    <div class="option-item">
                                        ${opt}
                                        <button onclick="this.parentNode.remove()" class="delete-option-btn">Delete</button>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="correct-answers-container">
                                <label>Correct Answers:</label>
                                <div class="option-container">
                                    <input type="text" id="correct-answer-input-${questionId}" placeholder="Enter correct answer">
                                    <button onclick="addCorrectAnswer(this, '${questionId}')" class="add-answer-btn">Add Answer</button>
                                </div>
                                <div class="correct-answers-list" id="correct-answers-list-${questionId}">
                                    ${question.correctAnswers.map(ans => `
                                        <div class="correct-answer-item">
                                            ${ans}
                                            <button onclick="this.parentNode.remove()" class="delete-answer-btn">Delete</button>
                                        </div>
                                    `).join('')}
                                </div>
                                <div class="correct-answers-textbox-container" id="correct-answers-textbox-${questionId}"></div>
                            </div>
                            <button onclick="setOptionsAndCorrectAnswers(this, '${questionId}')" class="save-options-btn">Save Options</button>
                        </div>
                        <input type="hidden" name="options-${questionId}" value='${JSON.stringify(question.options)}'>
                        <input type="hidden" name="correct-answers-${questionId}" value='${JSON.stringify(question.correctAnswers)}'>
                    `;

                    questionList.appendChild(questionBlock);
                });
            }
        });
    }
}

function m_openTableModal() {
    // Opens the manager assessment table modal
    const modal = document.getElementById('m_retrieve-modal-overlay');
    modal.style.display = 'flex';
    document.addEventListener('keydown', trapFocus);
    // Focus the first focusable element
    const firstFocusable = modal.querySelector('button, input, select, textarea, [tabindex]:not([tabindex="-1"])');
    if (firstFocusable) firstFocusable.focus();
}

function m_closeTableModal() {
    // Closes the manager assessment table modal
    document.getElementById('m_retrieve-modal-overlay').style.display = 'none';
    document.removeEventListener('keydown', trapFocus);
}

function m_loadTableSettings() {
    // Loads and displays manager assessment settings in the table modal
    const settings = JSON.parse(localStorage.getItem('m_managerSettings'));
    if (settings && settings.questions) {
        const tableBody = document.getElementById('m_managerTableBody');
        tableBody.innerHTML = '';

        settings.questions.forEach((question, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:150px;">
                    <select style="padding: 8px 12px; border: 1px solid #cbd5e0; border-radius: 8px; background: white; font-size: 14px; min-width: 120px;">
                        <option value="active" ${question.status === 'active' ? 'selected' : ''}>Active</option>
                        <option value="delete">Delete</option>
                        <option value="deactivate" ${question.status === 'deactivate' ? 'selected' : ''}>Deactivate</option>
                        <option value="reactivate" ${question.status === 'reactivate' ? 'selected' : ''}>Reactivate</option>
                    </select>
                </td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${settings.targetGroup || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${settings.targetedIndividuals?.join(', ') || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${settings.feedbackVisibility || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${settings.assessmentFrequency || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${settings.assessmentDate || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.competenceArea}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.questionType}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:250px;">${question.questionNumber}. ${question.questionText}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.options.join(', ') || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:200px;">${question.correctAnswers.join(', ') || ''}</td>
                <td style="padding:8px 6px;border-bottom:1px solid #dee2e6;border-right:1px solid #e9ecef;text-align:left;vertical-align:middle;width:40px;">
                    <input type="checkbox" />
                </td>
            `;
            tableBody.appendChild(row);
        });
    }
}

// Event listener for the "Save & View Table" button
document.getElementById('m_save').addEventListener('click', function(event) {
    event.preventDefault(); // Prevent default form submission
    m_saveManagerSettings(); // Save settings and open table modal
});

// Event listener for the "Retrieve" button
document.getElementById('m_retrieve').addEventListener('click', function(event) {
    event.preventDefault();
    m_retrieveSettings();
});

// Event listener for the "Update Manager Settings" button in the table modal
document.getElementById('m_updateManagerBtn').addEventListener('click', function(event) {
    event.preventDefault();
    const tableBody = document.getElementById('m_managerTableBody');
    const settings = JSON.parse(localStorage.getItem('m_managerSettings')) || {
        targetGroup: document.querySelector('#m_target_group select')?.value || '',
        targetedIndividuals: Array.from(document.querySelectorAll('#m_targeted_individuals_select option:checked'))
            .map(opt => opt.textContent.trim()),
        feedbackVisibility: document.querySelector('#m_feedback_visibility select')?.value || '',
        assessmentFrequency: document.getElementById('m_assessment_frequency')?.value || '',
        assessmentDate: document.getElementById('m_assessment_date')?.value || '',
        questions: []
    };

    const updatedQuestions = [];
    Array.from(tableBody.children).forEach((row, index) => {
        const status = row.querySelector('select').value;
        if (status !== 'delete') {
            // Extract question text without the number prefix
            const questionTextWithNumber = row.children[8].textContent;
            const questionText = questionTextWithNumber.replace(/^\d+\.\s*/, '');
            updatedQuestions.push({
                questionText,
                questionType: row.children[7].textContent,
                competenceArea: row.children[6].textContent,
                options: row.children[9].textContent ? row.children[9].textContent.split(', ') : [],
                correctAnswers: row.children[10].textContent ? row.children[10].textContent.split(', ') : [],
                status: status,
                questionNumber: index + 1
            });
        }
    });

    settings.questions = updatedQuestions;
    localStorage.setItem('m_managerSettings', JSON.stringify(settings));
    m_loadTableSettings(); // Refresh table
    alert('Manager settings updated successfully!');
});

// Focus trapping for accessibility
function trapFocus(event) {
    if (event.key === 'Tab' || event.keyCode === 9) {
        const modal = document.getElementById('m_retrieve-modal-overlay');
        const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        const firstFocusableElement = focusableElements[0];
        const lastFocusableElement = focusableElements[focusableElements.length - 1];

        if (event.shiftKey) {
            if (document.activeElement === firstFocusableElement) {
                lastFocusableElement.focus();
                event.preventDefault();
            }
        } else {
            if (document.activeElement === lastFocusableElement) {
                firstFocusableElement.focus();
                event.preventDefault();
            }
        }
    }
}

// Attach click event to close modal when clicking outside content
document.getElementById('m_retrieve-modal-overlay').addEventListener('click', function(event) {
    if (event.target === this) {
        m_closeTableModal();
    }
});

</script>
</body>
</html>
